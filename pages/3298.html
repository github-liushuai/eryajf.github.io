<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Jenkinsfileå£°æ˜å¼è¯­æ³•è¯¦è§£ | äºŒä¸«è®²æ¢µ</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_3077305_pt8umhrn4k9.css">
    <script language="javascript" type="text/javascript" src="/js/pgmanor-self.js"></script>
    <link rel="alternate" type="application/rss+xml" href="https://wiki.eryajf.net/rss.xml" title="äºŒä¸«è®²æ¢µ RSS Feed">
    <link rel="alternate" type="application/atom+xml" href="https://wiki.eryajf.net/feed.atom" title="äºŒä¸«è®²æ¢µ Atom Feed">
    <link rel="alternate" type="application/json" href="https://wiki.eryajf.net/feed.json" title="äºŒä¸«è®²æ¢µ JSON Feed">
    <meta name="description" content="ğŸ’»å­¦ä¹ ğŸ“è®°å½•ğŸ”—åˆ†äº«
å­¦æ— æ­¢å¢ƒæ˜¯æ°¸è¿œå‰è¿›çš„åŸºç¡€ï¼Œè·ƒç„¶çº¸ä¸Šæ˜¯å¯¹çŸ¥è¯†çš„æ€»ç»“äº¤ä»£ï¼Œä¸ä¼—åˆ†äº«åˆ™æ˜¯å®ç°ä»·å€¼çš„æœ€å¥½æ–¹å¼ã€‚">
    <meta name="image" content="http://t.eryajf.net/imgs/2021/09/f126d7d667e038cd.jpg">
    <meta name="twitter:title" content="Jenkinsfileå£°æ˜å¼è¯­æ³•è¯¦è§£">
    <meta name="twitter:description" content="">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="http://t.eryajf.net/imgs/2021/09/f126d7d667e038cd.jpg">
    <meta name="twitter:url" content="https://wiki.eryajf.net/02.%E7%B3%BB%E5%88%97%E4%B8%93%E9%A2%98/05.Jenkins%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/32.Jenkinsfile%E5%A3%B0%E6%98%8E%E5%BC%8F%E8%AF%AD%E6%B3%95%E8%AF%A6%E8%A7%A3.html">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Jenkinsfileå£°æ˜å¼è¯­æ³•è¯¦è§£">
    <meta property="og:description" content="">
    <meta property="og:image" content="http://t.eryajf.net/imgs/2021/09/f126d7d667e038cd.jpg">
    <meta property="og:url" content="https://wiki.eryajf.net/02.%E7%B3%BB%E5%88%97%E4%B8%93%E9%A2%98/05.Jenkins%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/32.Jenkinsfile%E5%A3%B0%E6%98%8E%E5%BC%8F%E8%AF%AD%E6%B3%95%E8%AF%A6%E8%A7%A3.html">
    <meta property="og:site_name" content="Eryajf">
    <meta property="article:published_time" content="2019-09-15T21:18:46.000Z">
    <meta property="article:tag" content="jenkins">
    <meta itemprop="name" content="Jenkinsfileå£°æ˜å¼è¯­æ³•è¯¦è§£">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://t.eryajf.net/imgs/2021/09/f126d7d667e038cd.jpg">
    <meta name="keywords" content="äºŒä¸«è®²æ¢µ,Linux,è¿ç»´,yum,è¿ç»´è‰ºæœ¯,eryajf,jenkins,nexus,golang,vue">
    <meta name="baidu-site-verification" content="code-LTKHwOecxI">
    <meta name="theme-color" content="#11a8cd">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <link rel="preload" href="/assets/css/0.styles.490aa64e.css" as="style"><link rel="preload" href="/assets/js/app.b64d52e0.js" as="script"><link rel="preload" href="/assets/js/2.09106d93.js" as="script"><link rel="preload" href="/assets/js/254.dd193812.js" as="script"><link rel="prefetch" href="/assets/js/10.15ef867a.js"><link rel="prefetch" href="/assets/js/100.a09066f0.js"><link rel="prefetch" href="/assets/js/101.87dfe94d.js"><link rel="prefetch" href="/assets/js/102.17b33707.js"><link rel="prefetch" href="/assets/js/103.b220cf43.js"><link rel="prefetch" href="/assets/js/104.9ab83364.js"><link rel="prefetch" href="/assets/js/105.ae924099.js"><link rel="prefetch" href="/assets/js/106.db60b3ac.js"><link rel="prefetch" href="/assets/js/107.22956c0b.js"><link rel="prefetch" href="/assets/js/108.5be2b5a5.js"><link rel="prefetch" href="/assets/js/109.8bc00d64.js"><link rel="prefetch" href="/assets/js/11.17cf8242.js"><link rel="prefetch" href="/assets/js/110.73039801.js"><link rel="prefetch" href="/assets/js/111.e52d4e2f.js"><link rel="prefetch" href="/assets/js/112.637178d0.js"><link rel="prefetch" href="/assets/js/113.b482195b.js"><link rel="prefetch" href="/assets/js/114.370467f0.js"><link rel="prefetch" href="/assets/js/115.49a702b3.js"><link rel="prefetch" href="/assets/js/116.9a853240.js"><link rel="prefetch" href="/assets/js/117.3224c42c.js"><link rel="prefetch" href="/assets/js/118.fc5f92ea.js"><link rel="prefetch" href="/assets/js/119.03edd7ea.js"><link rel="prefetch" href="/assets/js/12.5dbf4e34.js"><link rel="prefetch" href="/assets/js/120.581dea25.js"><link rel="prefetch" href="/assets/js/121.21769b93.js"><link rel="prefetch" href="/assets/js/122.913d901b.js"><link rel="prefetch" href="/assets/js/123.619968e5.js"><link rel="prefetch" href="/assets/js/124.28a0edd1.js"><link rel="prefetch" href="/assets/js/125.24147bdd.js"><link rel="prefetch" href="/assets/js/126.84b93f04.js"><link rel="prefetch" href="/assets/js/127.fc3dc871.js"><link rel="prefetch" href="/assets/js/128.cc9c516c.js"><link rel="prefetch" href="/assets/js/129.c9f9a866.js"><link rel="prefetch" href="/assets/js/13.25c4bf63.js"><link rel="prefetch" href="/assets/js/130.f72d5e3c.js"><link rel="prefetch" href="/assets/js/131.aa86a427.js"><link rel="prefetch" href="/assets/js/132.d34ef8c9.js"><link rel="prefetch" href="/assets/js/133.61fe2407.js"><link rel="prefetch" href="/assets/js/134.75f26d4a.js"><link rel="prefetch" href="/assets/js/135.f768b626.js"><link rel="prefetch" href="/assets/js/136.c7e855b7.js"><link rel="prefetch" href="/assets/js/137.efdd6444.js"><link rel="prefetch" href="/assets/js/138.bcba273d.js"><link rel="prefetch" href="/assets/js/139.96def2ce.js"><link rel="prefetch" href="/assets/js/14.825005f1.js"><link rel="prefetch" href="/assets/js/140.c714dea2.js"><link rel="prefetch" href="/assets/js/141.b0c5a1b5.js"><link rel="prefetch" href="/assets/js/142.88f3420d.js"><link rel="prefetch" href="/assets/js/143.0002b84f.js"><link rel="prefetch" href="/assets/js/144.fb709135.js"><link rel="prefetch" href="/assets/js/145.84987a48.js"><link rel="prefetch" href="/assets/js/146.f62ef02a.js"><link rel="prefetch" href="/assets/js/147.32614a80.js"><link rel="prefetch" href="/assets/js/148.842cf367.js"><link rel="prefetch" href="/assets/js/149.26bb38c6.js"><link rel="prefetch" href="/assets/js/15.651b5e76.js"><link rel="prefetch" href="/assets/js/150.63b1b784.js"><link rel="prefetch" href="/assets/js/151.0212b10f.js"><link rel="prefetch" href="/assets/js/152.c2041fff.js"><link rel="prefetch" href="/assets/js/153.236d6c9d.js"><link rel="prefetch" href="/assets/js/154.d1ef24bc.js"><link rel="prefetch" href="/assets/js/155.1bfc465b.js"><link rel="prefetch" href="/assets/js/156.0b51b05b.js"><link rel="prefetch" href="/assets/js/157.a72900c5.js"><link rel="prefetch" href="/assets/js/158.7cdccb10.js"><link rel="prefetch" href="/assets/js/159.05014aa0.js"><link rel="prefetch" href="/assets/js/16.e4b8feb4.js"><link rel="prefetch" href="/assets/js/160.aa8bf21a.js"><link rel="prefetch" href="/assets/js/161.e661ef5f.js"><link rel="prefetch" href="/assets/js/162.f3e077d1.js"><link rel="prefetch" href="/assets/js/163.ac4d8489.js"><link rel="prefetch" href="/assets/js/164.5c9a804d.js"><link rel="prefetch" href="/assets/js/165.dd3607b5.js"><link rel="prefetch" href="/assets/js/166.9fddf3c4.js"><link rel="prefetch" href="/assets/js/167.d1910438.js"><link rel="prefetch" href="/assets/js/168.c53f614c.js"><link rel="prefetch" href="/assets/js/169.48dbebde.js"><link rel="prefetch" href="/assets/js/17.26630549.js"><link rel="prefetch" href="/assets/js/170.ea0a11a4.js"><link rel="prefetch" href="/assets/js/171.b29e1a48.js"><link rel="prefetch" href="/assets/js/172.ea11776c.js"><link rel="prefetch" href="/assets/js/173.28a7e0ed.js"><link rel="prefetch" href="/assets/js/174.da5e68da.js"><link rel="prefetch" href="/assets/js/175.ed980d63.js"><link rel="prefetch" href="/assets/js/176.4ee75968.js"><link rel="prefetch" href="/assets/js/177.395f1efc.js"><link rel="prefetch" href="/assets/js/178.0b0b4110.js"><link rel="prefetch" href="/assets/js/179.0e1b79a4.js"><link rel="prefetch" href="/assets/js/18.b0c23a1e.js"><link rel="prefetch" href="/assets/js/180.04a59016.js"><link rel="prefetch" href="/assets/js/181.eacb1554.js"><link rel="prefetch" href="/assets/js/182.9489324a.js"><link rel="prefetch" href="/assets/js/183.22a9fef4.js"><link rel="prefetch" href="/assets/js/184.e4f66aad.js"><link rel="prefetch" href="/assets/js/185.782b8fe1.js"><link rel="prefetch" href="/assets/js/186.c5fd1b18.js"><link rel="prefetch" href="/assets/js/187.ac950318.js"><link rel="prefetch" href="/assets/js/188.24855268.js"><link rel="prefetch" href="/assets/js/189.2ff9d69f.js"><link rel="prefetch" href="/assets/js/19.2350925e.js"><link rel="prefetch" href="/assets/js/190.ce6d47c4.js"><link rel="prefetch" href="/assets/js/191.cbe451ae.js"><link rel="prefetch" href="/assets/js/192.fad5864e.js"><link rel="prefetch" href="/assets/js/193.99a8159d.js"><link rel="prefetch" href="/assets/js/194.9dff990c.js"><link rel="prefetch" href="/assets/js/195.0326a347.js"><link rel="prefetch" href="/assets/js/196.46a566f6.js"><link rel="prefetch" href="/assets/js/197.4be39b40.js"><link rel="prefetch" href="/assets/js/198.d3a2df34.js"><link rel="prefetch" href="/assets/js/199.b0428697.js"><link rel="prefetch" href="/assets/js/20.99992852.js"><link rel="prefetch" href="/assets/js/200.bf1cab23.js"><link rel="prefetch" href="/assets/js/201.7078426f.js"><link rel="prefetch" href="/assets/js/202.63b3ae2e.js"><link rel="prefetch" href="/assets/js/203.2bee7d51.js"><link rel="prefetch" href="/assets/js/204.71993570.js"><link rel="prefetch" href="/assets/js/205.10d32d9a.js"><link rel="prefetch" href="/assets/js/206.9a2e1976.js"><link rel="prefetch" href="/assets/js/207.0a9ead6c.js"><link rel="prefetch" href="/assets/js/208.968951ab.js"><link rel="prefetch" href="/assets/js/209.ce388b6b.js"><link rel="prefetch" href="/assets/js/21.1ae37732.js"><link rel="prefetch" href="/assets/js/210.14e0728d.js"><link rel="prefetch" href="/assets/js/211.49dcc741.js"><link rel="prefetch" href="/assets/js/212.a9f0340d.js"><link rel="prefetch" href="/assets/js/213.8e2b09a8.js"><link rel="prefetch" href="/assets/js/214.74ca607d.js"><link rel="prefetch" href="/assets/js/215.7ab62f50.js"><link rel="prefetch" href="/assets/js/216.0c92c485.js"><link rel="prefetch" href="/assets/js/217.40d5dddc.js"><link rel="prefetch" href="/assets/js/218.13e60393.js"><link rel="prefetch" href="/assets/js/219.8d3c8006.js"><link rel="prefetch" href="/assets/js/22.f2d31ec6.js"><link rel="prefetch" href="/assets/js/220.d52056a1.js"><link rel="prefetch" href="/assets/js/221.f9470ab7.js"><link rel="prefetch" href="/assets/js/222.840d669c.js"><link rel="prefetch" href="/assets/js/223.4272af50.js"><link rel="prefetch" href="/assets/js/224.899c6786.js"><link rel="prefetch" href="/assets/js/225.be23e297.js"><link rel="prefetch" href="/assets/js/226.f891aa20.js"><link rel="prefetch" href="/assets/js/227.48c907e9.js"><link rel="prefetch" href="/assets/js/228.f4fcd5e3.js"><link rel="prefetch" href="/assets/js/229.ff60d5c1.js"><link rel="prefetch" href="/assets/js/23.a96d3c8c.js"><link rel="prefetch" href="/assets/js/230.568de4f4.js"><link rel="prefetch" href="/assets/js/231.c0465bbd.js"><link rel="prefetch" href="/assets/js/232.5cef1c01.js"><link rel="prefetch" href="/assets/js/233.499706ff.js"><link rel="prefetch" href="/assets/js/234.1f2f03d4.js"><link rel="prefetch" href="/assets/js/235.0125a657.js"><link rel="prefetch" href="/assets/js/236.5f119855.js"><link rel="prefetch" href="/assets/js/237.8ddd947b.js"><link rel="prefetch" href="/assets/js/238.185aeb33.js"><link rel="prefetch" href="/assets/js/239.01c5b429.js"><link rel="prefetch" href="/assets/js/24.2b2c66ca.js"><link rel="prefetch" href="/assets/js/240.8906b2a8.js"><link rel="prefetch" href="/assets/js/241.a213ed03.js"><link rel="prefetch" href="/assets/js/242.f0b35bda.js"><link rel="prefetch" href="/assets/js/243.3b5fb81b.js"><link rel="prefetch" href="/assets/js/244.922fd344.js"><link rel="prefetch" href="/assets/js/245.f3fd6635.js"><link rel="prefetch" href="/assets/js/246.eda8f093.js"><link rel="prefetch" href="/assets/js/247.68ab8530.js"><link rel="prefetch" href="/assets/js/248.229cd98c.js"><link rel="prefetch" href="/assets/js/249.834b8858.js"><link rel="prefetch" href="/assets/js/25.9b38179c.js"><link rel="prefetch" href="/assets/js/250.02b4ecef.js"><link rel="prefetch" href="/assets/js/251.b208144b.js"><link rel="prefetch" href="/assets/js/252.846569f7.js"><link rel="prefetch" href="/assets/js/253.4c6975a3.js"><link rel="prefetch" href="/assets/js/255.6bf0bc8e.js"><link rel="prefetch" href="/assets/js/256.cf556c43.js"><link rel="prefetch" href="/assets/js/257.345a265d.js"><link rel="prefetch" href="/assets/js/258.5d203d9e.js"><link rel="prefetch" href="/assets/js/259.0ed5455a.js"><link rel="prefetch" href="/assets/js/26.4781bd5a.js"><link rel="prefetch" href="/assets/js/260.c954d5d2.js"><link rel="prefetch" href="/assets/js/261.df7926e3.js"><link rel="prefetch" href="/assets/js/262.3363153b.js"><link rel="prefetch" href="/assets/js/263.a57dec99.js"><link rel="prefetch" href="/assets/js/264.9f3a06e6.js"><link rel="prefetch" href="/assets/js/265.15ef9c0b.js"><link rel="prefetch" href="/assets/js/266.b9d146fa.js"><link rel="prefetch" href="/assets/js/267.f240c9eb.js"><link rel="prefetch" href="/assets/js/268.98a013e2.js"><link rel="prefetch" href="/assets/js/269.73c1d8ef.js"><link rel="prefetch" href="/assets/js/27.bbf9fc6d.js"><link rel="prefetch" href="/assets/js/270.afad5a4f.js"><link rel="prefetch" href="/assets/js/271.aa8bc64a.js"><link rel="prefetch" href="/assets/js/272.874ac668.js"><link rel="prefetch" href="/assets/js/273.4b67b374.js"><link rel="prefetch" href="/assets/js/274.68b25dde.js"><link rel="prefetch" href="/assets/js/275.ebab9315.js"><link rel="prefetch" href="/assets/js/276.29d1be7f.js"><link rel="prefetch" href="/assets/js/277.415ec925.js"><link rel="prefetch" href="/assets/js/278.16c7fc3d.js"><link rel="prefetch" href="/assets/js/279.256cab6a.js"><link rel="prefetch" href="/assets/js/28.8f277335.js"><link rel="prefetch" href="/assets/js/280.82889251.js"><link rel="prefetch" href="/assets/js/281.2bda2349.js"><link rel="prefetch" href="/assets/js/282.7fa42978.js"><link rel="prefetch" href="/assets/js/283.e4e4a9ac.js"><link rel="prefetch" href="/assets/js/284.ebf82356.js"><link rel="prefetch" href="/assets/js/285.0a438f8e.js"><link rel="prefetch" href="/assets/js/286.773ae4fb.js"><link rel="prefetch" href="/assets/js/287.13b6452a.js"><link rel="prefetch" href="/assets/js/288.f35f2f83.js"><link rel="prefetch" href="/assets/js/289.f7430738.js"><link rel="prefetch" href="/assets/js/29.8caeb90b.js"><link rel="prefetch" href="/assets/js/290.6da91943.js"><link rel="prefetch" href="/assets/js/291.bf7b0083.js"><link rel="prefetch" href="/assets/js/292.edc0f459.js"><link rel="prefetch" href="/assets/js/293.e0284ca8.js"><link rel="prefetch" href="/assets/js/294.3cb425c4.js"><link rel="prefetch" href="/assets/js/295.345f4f96.js"><link rel="prefetch" href="/assets/js/296.acd0509a.js"><link rel="prefetch" href="/assets/js/297.679b06d2.js"><link rel="prefetch" href="/assets/js/298.0271c62c.js"><link rel="prefetch" href="/assets/js/299.29c9b461.js"><link rel="prefetch" href="/assets/js/3.90a30a49.js"><link rel="prefetch" href="/assets/js/30.b3c40ab0.js"><link rel="prefetch" href="/assets/js/300.3c5e140e.js"><link rel="prefetch" href="/assets/js/301.e84c65aa.js"><link rel="prefetch" href="/assets/js/302.f90e8c94.js"><link rel="prefetch" href="/assets/js/303.62ba9b6f.js"><link rel="prefetch" href="/assets/js/304.49aa145c.js"><link rel="prefetch" href="/assets/js/305.c27efc95.js"><link rel="prefetch" href="/assets/js/306.8f433113.js"><link rel="prefetch" href="/assets/js/307.7e308dfb.js"><link rel="prefetch" href="/assets/js/308.aba1b8e5.js"><link rel="prefetch" href="/assets/js/309.bf24246a.js"><link rel="prefetch" href="/assets/js/31.af3adf79.js"><link rel="prefetch" href="/assets/js/310.53b7bb00.js"><link rel="prefetch" href="/assets/js/311.65a700b3.js"><link rel="prefetch" href="/assets/js/312.8f0ee5b2.js"><link rel="prefetch" href="/assets/js/313.29dea1ec.js"><link rel="prefetch" href="/assets/js/314.23a053df.js"><link rel="prefetch" href="/assets/js/315.f098573b.js"><link rel="prefetch" href="/assets/js/316.a061bdc3.js"><link rel="prefetch" href="/assets/js/317.fb2cceb7.js"><link rel="prefetch" href="/assets/js/318.627cb2bc.js"><link rel="prefetch" href="/assets/js/319.8b033c99.js"><link rel="prefetch" href="/assets/js/32.3b817f11.js"><link rel="prefetch" href="/assets/js/320.a0f95aee.js"><link rel="prefetch" href="/assets/js/321.715e1609.js"><link rel="prefetch" href="/assets/js/322.b765c668.js"><link rel="prefetch" href="/assets/js/323.6a41443f.js"><link rel="prefetch" href="/assets/js/324.50626ce1.js"><link rel="prefetch" href="/assets/js/325.a7cd17f0.js"><link rel="prefetch" href="/assets/js/326.aeebe105.js"><link rel="prefetch" href="/assets/js/327.6fe22e33.js"><link rel="prefetch" href="/assets/js/328.dfc72926.js"><link rel="prefetch" href="/assets/js/329.eed2f816.js"><link rel="prefetch" href="/assets/js/33.897e8424.js"><link rel="prefetch" href="/assets/js/330.6eb37623.js"><link rel="prefetch" href="/assets/js/331.ae298be4.js"><link rel="prefetch" href="/assets/js/332.e020bef7.js"><link rel="prefetch" href="/assets/js/333.a3659044.js"><link rel="prefetch" href="/assets/js/334.1c76bade.js"><link rel="prefetch" href="/assets/js/335.a508f4de.js"><link rel="prefetch" href="/assets/js/336.8b5e4ac1.js"><link rel="prefetch" href="/assets/js/337.3cc918fb.js"><link rel="prefetch" href="/assets/js/338.a5c271db.js"><link rel="prefetch" href="/assets/js/339.c2cc089b.js"><link rel="prefetch" href="/assets/js/34.6396378b.js"><link rel="prefetch" href="/assets/js/340.8f85233a.js"><link rel="prefetch" href="/assets/js/341.9722428b.js"><link rel="prefetch" href="/assets/js/342.2a499e4c.js"><link rel="prefetch" href="/assets/js/343.88309fd7.js"><link rel="prefetch" href="/assets/js/344.6f9f891e.js"><link rel="prefetch" href="/assets/js/345.fe312901.js"><link rel="prefetch" href="/assets/js/346.0e178041.js"><link rel="prefetch" href="/assets/js/347.f6ca93ec.js"><link rel="prefetch" href="/assets/js/348.757832e9.js"><link rel="prefetch" href="/assets/js/349.ecd0f0b8.js"><link rel="prefetch" href="/assets/js/35.a9f83bb9.js"><link rel="prefetch" href="/assets/js/350.4eceec79.js"><link rel="prefetch" href="/assets/js/351.c12795b9.js"><link rel="prefetch" href="/assets/js/352.213f6a13.js"><link rel="prefetch" href="/assets/js/353.44987602.js"><link rel="prefetch" href="/assets/js/354.c5515b44.js"><link rel="prefetch" href="/assets/js/355.9e86cdcd.js"><link rel="prefetch" href="/assets/js/356.e410314c.js"><link rel="prefetch" href="/assets/js/357.490267a8.js"><link rel="prefetch" href="/assets/js/358.155defaa.js"><link rel="prefetch" href="/assets/js/359.00ecad3c.js"><link rel="prefetch" href="/assets/js/36.ff1983df.js"><link rel="prefetch" href="/assets/js/360.2b8386ee.js"><link rel="prefetch" href="/assets/js/361.388984a7.js"><link rel="prefetch" href="/assets/js/362.04ec936f.js"><link rel="prefetch" href="/assets/js/363.b95a343c.js"><link rel="prefetch" href="/assets/js/364.db323289.js"><link rel="prefetch" href="/assets/js/365.55d6449c.js"><link rel="prefetch" href="/assets/js/366.af2d3f70.js"><link rel="prefetch" href="/assets/js/367.c7612247.js"><link rel="prefetch" href="/assets/js/368.63f34205.js"><link rel="prefetch" href="/assets/js/369.5de7e28f.js"><link rel="prefetch" href="/assets/js/37.4b7b968f.js"><link rel="prefetch" href="/assets/js/370.32376b34.js"><link rel="prefetch" href="/assets/js/371.c80a270c.js"><link rel="prefetch" href="/assets/js/372.cea05955.js"><link rel="prefetch" href="/assets/js/373.7b682eba.js"><link rel="prefetch" href="/assets/js/374.e178c112.js"><link rel="prefetch" href="/assets/js/375.b12b31c3.js"><link rel="prefetch" href="/assets/js/376.4f84ab84.js"><link rel="prefetch" href="/assets/js/377.b50bcd82.js"><link rel="prefetch" href="/assets/js/378.37dea386.js"><link rel="prefetch" href="/assets/js/379.92a3e6c1.js"><link rel="prefetch" href="/assets/js/38.e4079b66.js"><link rel="prefetch" href="/assets/js/380.35992c37.js"><link rel="prefetch" href="/assets/js/381.13953ae7.js"><link rel="prefetch" href="/assets/js/382.99f19baf.js"><link rel="prefetch" href="/assets/js/383.04b581ec.js"><link rel="prefetch" href="/assets/js/384.90540078.js"><link rel="prefetch" href="/assets/js/385.9c43613a.js"><link rel="prefetch" href="/assets/js/386.24f1c8ee.js"><link rel="prefetch" href="/assets/js/387.e1504e7f.js"><link rel="prefetch" href="/assets/js/388.cad745d2.js"><link rel="prefetch" href="/assets/js/389.c34d6a02.js"><link rel="prefetch" href="/assets/js/39.9db8ff5b.js"><link rel="prefetch" href="/assets/js/390.7e0eb533.js"><link rel="prefetch" href="/assets/js/391.71915b9a.js"><link rel="prefetch" href="/assets/js/392.e34bca6d.js"><link rel="prefetch" href="/assets/js/393.cbb1210c.js"><link rel="prefetch" href="/assets/js/394.71d2e8ec.js"><link rel="prefetch" href="/assets/js/395.3658697b.js"><link rel="prefetch" href="/assets/js/396.99fc1bcb.js"><link rel="prefetch" href="/assets/js/397.12956242.js"><link rel="prefetch" href="/assets/js/398.362a2320.js"><link rel="prefetch" href="/assets/js/399.e3af3efb.js"><link rel="prefetch" href="/assets/js/4.ed35146c.js"><link rel="prefetch" href="/assets/js/40.9b3c111a.js"><link rel="prefetch" href="/assets/js/400.be8f378d.js"><link rel="prefetch" href="/assets/js/401.7855cda3.js"><link rel="prefetch" href="/assets/js/402.1f68f76a.js"><link rel="prefetch" href="/assets/js/403.a84e1ef3.js"><link rel="prefetch" href="/assets/js/404.f402bfe7.js"><link rel="prefetch" href="/assets/js/405.f34e5c3e.js"><link rel="prefetch" href="/assets/js/406.7309b1b5.js"><link rel="prefetch" href="/assets/js/407.59d98fc7.js"><link rel="prefetch" href="/assets/js/408.743645bb.js"><link rel="prefetch" href="/assets/js/409.e2a4b865.js"><link rel="prefetch" href="/assets/js/41.1fc60b69.js"><link rel="prefetch" href="/assets/js/410.0823fd90.js"><link rel="prefetch" href="/assets/js/411.ee162292.js"><link rel="prefetch" href="/assets/js/412.0a8a0d30.js"><link rel="prefetch" href="/assets/js/413.477477a2.js"><link rel="prefetch" href="/assets/js/414.75355711.js"><link rel="prefetch" href="/assets/js/415.37d7a317.js"><link rel="prefetch" href="/assets/js/416.cdf693cc.js"><link rel="prefetch" href="/assets/js/417.f88409c1.js"><link rel="prefetch" href="/assets/js/418.af9df621.js"><link rel="prefetch" href="/assets/js/419.9e94a2fa.js"><link rel="prefetch" href="/assets/js/42.186cd9a4.js"><link rel="prefetch" href="/assets/js/420.fcd284c3.js"><link rel="prefetch" href="/assets/js/421.d9ad6856.js"><link rel="prefetch" href="/assets/js/422.9e3a6908.js"><link rel="prefetch" href="/assets/js/423.f6128567.js"><link rel="prefetch" href="/assets/js/424.9eb46659.js"><link rel="prefetch" href="/assets/js/425.a23b9c70.js"><link rel="prefetch" href="/assets/js/426.0d22e3c4.js"><link rel="prefetch" href="/assets/js/427.a394d3ae.js"><link rel="prefetch" href="/assets/js/428.ab6b507a.js"><link rel="prefetch" href="/assets/js/429.9346925c.js"><link rel="prefetch" href="/assets/js/43.404f41b6.js"><link rel="prefetch" href="/assets/js/430.53ef27da.js"><link rel="prefetch" href="/assets/js/431.c48a69ad.js"><link rel="prefetch" href="/assets/js/432.8bec03cf.js"><link rel="prefetch" href="/assets/js/433.bc4f51ba.js"><link rel="prefetch" href="/assets/js/434.6a27ff5e.js"><link rel="prefetch" href="/assets/js/435.528944ba.js"><link rel="prefetch" href="/assets/js/436.2fbbda0d.js"><link rel="prefetch" href="/assets/js/437.42cbd75e.js"><link rel="prefetch" href="/assets/js/438.1a8ce223.js"><link rel="prefetch" href="/assets/js/439.8fde150b.js"><link rel="prefetch" href="/assets/js/44.86df32f7.js"><link rel="prefetch" href="/assets/js/440.5fc14536.js"><link rel="prefetch" href="/assets/js/441.57b25656.js"><link rel="prefetch" href="/assets/js/442.5a1f00af.js"><link rel="prefetch" href="/assets/js/443.e5c1af8b.js"><link rel="prefetch" href="/assets/js/444.642373f2.js"><link rel="prefetch" href="/assets/js/445.cebdb177.js"><link rel="prefetch" href="/assets/js/446.0cee4c07.js"><link rel="prefetch" href="/assets/js/447.0ebe4cd2.js"><link rel="prefetch" href="/assets/js/448.733a0f64.js"><link rel="prefetch" href="/assets/js/449.e0e9066f.js"><link rel="prefetch" href="/assets/js/45.c6912659.js"><link rel="prefetch" href="/assets/js/450.5139ca2c.js"><link rel="prefetch" href="/assets/js/451.07f34d86.js"><link rel="prefetch" href="/assets/js/452.a7876410.js"><link rel="prefetch" href="/assets/js/453.85b05369.js"><link rel="prefetch" href="/assets/js/454.1604b37e.js"><link rel="prefetch" href="/assets/js/455.f0fdb0e9.js"><link rel="prefetch" href="/assets/js/456.d5867a5c.js"><link rel="prefetch" href="/assets/js/457.34cbe54e.js"><link rel="prefetch" href="/assets/js/458.c8109693.js"><link rel="prefetch" href="/assets/js/459.a4627e96.js"><link rel="prefetch" href="/assets/js/46.22221e8c.js"><link rel="prefetch" href="/assets/js/460.0e16995b.js"><link rel="prefetch" href="/assets/js/461.fad5fa6c.js"><link rel="prefetch" href="/assets/js/462.35393f6f.js"><link rel="prefetch" href="/assets/js/463.509b2f5e.js"><link rel="prefetch" href="/assets/js/464.7902a40b.js"><link rel="prefetch" href="/assets/js/465.b44b0b3d.js"><link rel="prefetch" href="/assets/js/466.c3262b6e.js"><link rel="prefetch" href="/assets/js/467.b767ba55.js"><link rel="prefetch" href="/assets/js/468.78d1eb8d.js"><link rel="prefetch" href="/assets/js/469.d931cce5.js"><link rel="prefetch" href="/assets/js/47.92a88046.js"><link rel="prefetch" href="/assets/js/470.346b482b.js"><link rel="prefetch" href="/assets/js/471.6f42f729.js"><link rel="prefetch" href="/assets/js/472.9d3095d8.js"><link rel="prefetch" href="/assets/js/473.b422233d.js"><link rel="prefetch" href="/assets/js/474.f99827b7.js"><link rel="prefetch" href="/assets/js/475.13f3128e.js"><link rel="prefetch" href="/assets/js/476.5212ef64.js"><link rel="prefetch" href="/assets/js/477.3d8446cd.js"><link rel="prefetch" href="/assets/js/478.7fa09636.js"><link rel="prefetch" href="/assets/js/479.b930254b.js"><link rel="prefetch" href="/assets/js/48.b9fb8398.js"><link rel="prefetch" href="/assets/js/480.b877ec10.js"><link rel="prefetch" href="/assets/js/481.6b15bd8c.js"><link rel="prefetch" href="/assets/js/482.a1b31c18.js"><link rel="prefetch" href="/assets/js/483.b478b049.js"><link rel="prefetch" href="/assets/js/484.a9be98fc.js"><link rel="prefetch" href="/assets/js/485.b0c88413.js"><link rel="prefetch" href="/assets/js/486.9f8eb33c.js"><link rel="prefetch" href="/assets/js/487.4c2735e6.js"><link rel="prefetch" href="/assets/js/488.1187d6fe.js"><link rel="prefetch" href="/assets/js/489.5e226786.js"><link rel="prefetch" href="/assets/js/49.8dba3690.js"><link rel="prefetch" href="/assets/js/490.96b7335b.js"><link rel="prefetch" href="/assets/js/491.2215e18d.js"><link rel="prefetch" href="/assets/js/492.decc0c8b.js"><link rel="prefetch" href="/assets/js/493.eb1c54f9.js"><link rel="prefetch" href="/assets/js/494.c38907f6.js"><link rel="prefetch" href="/assets/js/495.8a6f91c9.js"><link rel="prefetch" href="/assets/js/496.f07f9895.js"><link rel="prefetch" href="/assets/js/497.39a289cd.js"><link rel="prefetch" href="/assets/js/498.c6cd8db6.js"><link rel="prefetch" href="/assets/js/499.88b92ee5.js"><link rel="prefetch" href="/assets/js/5.c6212358.js"><link rel="prefetch" href="/assets/js/50.a3904171.js"><link rel="prefetch" href="/assets/js/500.a8b1077c.js"><link rel="prefetch" href="/assets/js/501.bd65ed85.js"><link rel="prefetch" href="/assets/js/502.de27247a.js"><link rel="prefetch" href="/assets/js/503.3bab7bca.js"><link rel="prefetch" href="/assets/js/504.985e3dc5.js"><link rel="prefetch" href="/assets/js/505.0e7dffcc.js"><link rel="prefetch" href="/assets/js/506.a6911997.js"><link rel="prefetch" href="/assets/js/507.0744876e.js"><link rel="prefetch" href="/assets/js/508.4a467195.js"><link rel="prefetch" href="/assets/js/509.bd53eeb5.js"><link rel="prefetch" href="/assets/js/51.121d3e0b.js"><link rel="prefetch" href="/assets/js/510.243e05fc.js"><link rel="prefetch" href="/assets/js/511.58742d07.js"><link rel="prefetch" href="/assets/js/512.1088ee5c.js"><link rel="prefetch" href="/assets/js/513.1913e5ea.js"><link rel="prefetch" href="/assets/js/514.66c71f3d.js"><link rel="prefetch" href="/assets/js/515.adad3da2.js"><link rel="prefetch" href="/assets/js/516.e63a53ce.js"><link rel="prefetch" href="/assets/js/517.96d2bde5.js"><link rel="prefetch" href="/assets/js/518.a33eb8a2.js"><link rel="prefetch" href="/assets/js/519.357142bc.js"><link rel="prefetch" href="/assets/js/52.3b51a70a.js"><link rel="prefetch" href="/assets/js/520.d613f439.js"><link rel="prefetch" href="/assets/js/521.42faee9e.js"><link rel="prefetch" href="/assets/js/522.f12a6a4d.js"><link rel="prefetch" href="/assets/js/523.02853581.js"><link rel="prefetch" href="/assets/js/524.a2666cc0.js"><link rel="prefetch" href="/assets/js/525.fe00de1d.js"><link rel="prefetch" href="/assets/js/526.836568c5.js"><link rel="prefetch" href="/assets/js/527.8cd2af63.js"><link rel="prefetch" href="/assets/js/528.0b7365fd.js"><link rel="prefetch" href="/assets/js/529.43fa2e50.js"><link rel="prefetch" href="/assets/js/53.cdae485c.js"><link rel="prefetch" href="/assets/js/530.dcf6a67d.js"><link rel="prefetch" href="/assets/js/531.0a2c3b14.js"><link rel="prefetch" href="/assets/js/532.ea07a008.js"><link rel="prefetch" href="/assets/js/533.6055e01f.js"><link rel="prefetch" href="/assets/js/534.51632c3d.js"><link rel="prefetch" href="/assets/js/535.78fca5f3.js"><link rel="prefetch" href="/assets/js/536.a1a6b416.js"><link rel="prefetch" href="/assets/js/537.8598378e.js"><link rel="prefetch" href="/assets/js/538.1e52acaa.js"><link rel="prefetch" href="/assets/js/539.1cdafffa.js"><link rel="prefetch" href="/assets/js/54.6bec8df9.js"><link rel="prefetch" href="/assets/js/540.e568849b.js"><link rel="prefetch" href="/assets/js/541.945e1605.js"><link rel="prefetch" href="/assets/js/542.849cce79.js"><link rel="prefetch" href="/assets/js/543.f883cd7b.js"><link rel="prefetch" href="/assets/js/544.82371332.js"><link rel="prefetch" href="/assets/js/545.cad7564d.js"><link rel="prefetch" href="/assets/js/546.34b66f1c.js"><link rel="prefetch" href="/assets/js/547.de4b0b16.js"><link rel="prefetch" href="/assets/js/548.1ea6496b.js"><link rel="prefetch" href="/assets/js/549.af4e6988.js"><link rel="prefetch" href="/assets/js/55.434a3f2d.js"><link rel="prefetch" href="/assets/js/550.96e95735.js"><link rel="prefetch" href="/assets/js/551.f169353b.js"><link rel="prefetch" href="/assets/js/552.34941581.js"><link rel="prefetch" href="/assets/js/553.c5eb9a15.js"><link rel="prefetch" href="/assets/js/554.6572e1ae.js"><link rel="prefetch" href="/assets/js/555.f4434f7c.js"><link rel="prefetch" href="/assets/js/556.f8b3fd5b.js"><link rel="prefetch" href="/assets/js/557.d7158b72.js"><link rel="prefetch" href="/assets/js/558.e5071c1c.js"><link rel="prefetch" href="/assets/js/559.7a9fc855.js"><link rel="prefetch" href="/assets/js/56.f90b7f70.js"><link rel="prefetch" href="/assets/js/560.8b420031.js"><link rel="prefetch" href="/assets/js/561.2011eafe.js"><link rel="prefetch" href="/assets/js/562.3b87b54b.js"><link rel="prefetch" href="/assets/js/563.80149f2c.js"><link rel="prefetch" href="/assets/js/564.9d50f137.js"><link rel="prefetch" href="/assets/js/565.d18f2bb7.js"><link rel="prefetch" href="/assets/js/566.b8361281.js"><link rel="prefetch" href="/assets/js/567.09f477ad.js"><link rel="prefetch" href="/assets/js/568.c7290521.js"><link rel="prefetch" href="/assets/js/569.b13de1cf.js"><link rel="prefetch" href="/assets/js/57.b8199d69.js"><link rel="prefetch" href="/assets/js/570.96149def.js"><link rel="prefetch" href="/assets/js/571.1d918cc7.js"><link rel="prefetch" href="/assets/js/572.91cff7ad.js"><link rel="prefetch" href="/assets/js/573.e83fecab.js"><link rel="prefetch" href="/assets/js/574.f23266ff.js"><link rel="prefetch" href="/assets/js/575.1e588673.js"><link rel="prefetch" href="/assets/js/576.62e50cb6.js"><link rel="prefetch" href="/assets/js/577.443555e2.js"><link rel="prefetch" href="/assets/js/578.961c4fce.js"><link rel="prefetch" href="/assets/js/579.eb07ae46.js"><link rel="prefetch" href="/assets/js/58.1d97b00b.js"><link rel="prefetch" href="/assets/js/580.e6b8aee2.js"><link rel="prefetch" href="/assets/js/581.32539161.js"><link rel="prefetch" href="/assets/js/582.a1425a78.js"><link rel="prefetch" href="/assets/js/583.d6328aab.js"><link rel="prefetch" href="/assets/js/584.4ae96222.js"><link rel="prefetch" href="/assets/js/585.12eff688.js"><link rel="prefetch" href="/assets/js/586.eb3e494c.js"><link rel="prefetch" href="/assets/js/587.e03462d3.js"><link rel="prefetch" href="/assets/js/588.28774c19.js"><link rel="prefetch" href="/assets/js/589.c046a419.js"><link rel="prefetch" href="/assets/js/59.a0dc9381.js"><link rel="prefetch" href="/assets/js/590.b50ca1f6.js"><link rel="prefetch" href="/assets/js/591.6f35ed1e.js"><link rel="prefetch" href="/assets/js/592.28722cc2.js"><link rel="prefetch" href="/assets/js/593.4b0e9ccb.js"><link rel="prefetch" href="/assets/js/594.6cbec59b.js"><link rel="prefetch" href="/assets/js/595.729754e4.js"><link rel="prefetch" href="/assets/js/596.c69663ef.js"><link rel="prefetch" href="/assets/js/597.416f28b9.js"><link rel="prefetch" href="/assets/js/598.6e2fa6c6.js"><link rel="prefetch" href="/assets/js/599.22183717.js"><link rel="prefetch" href="/assets/js/6.0fa149be.js"><link rel="prefetch" href="/assets/js/60.93b6c9cf.js"><link rel="prefetch" href="/assets/js/61.9e4325b3.js"><link rel="prefetch" href="/assets/js/62.a32edcde.js"><link rel="prefetch" href="/assets/js/63.c29d51b8.js"><link rel="prefetch" href="/assets/js/64.64fb30d6.js"><link rel="prefetch" href="/assets/js/65.cb11a537.js"><link rel="prefetch" href="/assets/js/66.8ce66e17.js"><link rel="prefetch" href="/assets/js/67.70b84b16.js"><link rel="prefetch" href="/assets/js/68.76625bb4.js"><link rel="prefetch" href="/assets/js/69.96026823.js"><link rel="prefetch" href="/assets/js/7.e21823e3.js"><link rel="prefetch" href="/assets/js/70.85e51c54.js"><link rel="prefetch" href="/assets/js/71.e37c665e.js"><link rel="prefetch" href="/assets/js/72.5fab0457.js"><link rel="prefetch" href="/assets/js/73.42b323a0.js"><link rel="prefetch" href="/assets/js/74.9a577275.js"><link rel="prefetch" href="/assets/js/75.f92cb917.js"><link rel="prefetch" href="/assets/js/76.349cf956.js"><link rel="prefetch" href="/assets/js/77.68c1d13d.js"><link rel="prefetch" href="/assets/js/78.85bf3cf2.js"><link rel="prefetch" href="/assets/js/79.1bb973f3.js"><link rel="prefetch" href="/assets/js/8.4c1add94.js"><link rel="prefetch" href="/assets/js/80.83b9f94d.js"><link rel="prefetch" href="/assets/js/81.12f858bb.js"><link rel="prefetch" href="/assets/js/82.b3d6de39.js"><link rel="prefetch" href="/assets/js/83.6d8ba9ac.js"><link rel="prefetch" href="/assets/js/84.a03f7375.js"><link rel="prefetch" href="/assets/js/85.032de386.js"><link rel="prefetch" href="/assets/js/86.ec72191b.js"><link rel="prefetch" href="/assets/js/87.06245199.js"><link rel="prefetch" href="/assets/js/88.f62a1d2f.js"><link rel="prefetch" href="/assets/js/89.aa5d9cb4.js"><link rel="prefetch" href="/assets/js/9.2c0bab4f.js"><link rel="prefetch" href="/assets/js/90.a0602834.js"><link rel="prefetch" href="/assets/js/91.010fcd2f.js"><link rel="prefetch" href="/assets/js/92.165f59ce.js"><link rel="prefetch" href="/assets/js/93.1b6687ac.js"><link rel="prefetch" href="/assets/js/94.b89f9796.js"><link rel="prefetch" href="/assets/js/95.06790275.js"><link rel="prefetch" href="/assets/js/96.84be3bc8.js"><link rel="prefetch" href="/assets/js/97.0e8810f8.js"><link rel="prefetch" href="/assets/js/98.1b275d03.js"><link rel="prefetch" href="/assets/js/99.babd6741.js">
    <link rel="stylesheet" href="/assets/css/0.styles.490aa64e.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="ç›®å½•" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="äºŒä¸«è®²æ¢µ" class="logo"> <span class="site-name can-hide">äºŒä¸«è®²æ¢µ</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="è¿ç»´" class="dropdown-title"><a href="/ops/" class="link-title">è¿ç»´</a> <span class="title" style="display:none;">è¿ç»´</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/027a17/" class="nav-link">æœ€ä½³å®è·µ</a></li><li class="dropdown-item"><!----> <a href="/pages/29.html" class="nav-link">è¿åˆƒè€Œè§£</a></li><li class="dropdown-item"><!----> <a href="/pages/930.html" class="nav-link">Nginx</a></li><li class="dropdown-item"><!----> <a href="/pages/2782.html" class="nav-link">Php</a></li><li class="dropdown-item"><!----> <a href="/pages/596.html" class="nav-link">Zabbix</a></li><li class="dropdown-item"><!----> <a href="/pages/2468.html" class="nav-link">Prometheus</a></li><li class="dropdown-item"><!----> <a href="/pages/5380.html" class="nav-link">Grafana</a></li><li class="dropdown-item"><!----> <a href="/pages/5279.html" class="nav-link">CentOS</a></li><li class="dropdown-item"><!----> <a href="/pages/1847.html" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/pages/5173.html" class="nav-link">Ansible</a></li><li class="dropdown-item"><!----> <a href="/pages/3410.html" class="nav-link">Ldap</a></li><li class="dropdown-item"><!----> <a href="/pages/243.html" class="nav-link">Gitlab</a></li><li class="dropdown-item"><!----> <a href="/pages/2951.html" class="nav-link">Kafka</a></li><li class="dropdown-item"><!----> <a href="/pages/4050.html" class="nav-link">Etcd</a></li><li class="dropdown-item"><!----> <a href="/pages/f61d95/" class="nav-link">Consul</a></li><li class="dropdown-item"><!----> <a href="/pages/285.html" class="nav-link">Other</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ä¸“é¢˜" class="dropdown-title"><a href="/topic/" class="link-title">ä¸“é¢˜</a> <span class="title" style="display:none;">ä¸“é¢˜</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/2351.html" class="nav-link">ELK</a></li><li class="dropdown-item"><!----> <a href="/pages/1742.html" class="nav-link">K8S</a></li><li class="dropdown-item"><!----> <a href="/pages/45c5da/" class="nav-link">Nexus</a></li><li class="dropdown-item"><!----> <a href="/pages/2415.html" class="nav-link">Jenkins</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç”Ÿæ´»" class="dropdown-title"><a href="/life/" class="link-title">ç”Ÿæ´»</a> <span class="title" style="display:none;">ç”Ÿæ´»</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/2714.html" class="nav-link">éšå†™ç¼–å¹´</a></li><li class="dropdown-item"><!----> <a href="/pages/2442.html" class="nav-link">å®¶äººç‰©è¯­</a></li><li class="dropdown-item"><!----> <a href="/pages/fdb9f6/" class="nav-link">è¿½å¿†é’æ˜¥</a></li><li class="dropdown-item"><!----> <a href="/pages/3993f9/" class="nav-link">çˆ¶äº²çš„æœ‹å‹åœˆ</a></li><li class="dropdown-item"><!----> <a href="/pages/184.html" class="nav-link">ç”µå½±éŸ³ä¹</a></li><li class="dropdown-item"><!----> <a href="/pages/136.html" class="nav-link">æ•ˆç‡å·¥å…·</a></li><li class="dropdown-item"><!----> <a href="/pages/844.html" class="nav-link">åšå®¢ç›¸å…³</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç¼–ç¨‹" class="dropdown-title"><a href="/code/" class="link-title">ç¼–ç¨‹</a> <span class="title" style="display:none;">ç¼–ç¨‹</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/5164.html" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/pages/531.html" class="nav-link">Shell</a></li><li class="dropdown-item"><!----> <a href="/pages/aeab08/" class="nav-link">Golang</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å‘¨åˆŠ" class="dropdown-title"><a href="/pages/11c668/" class="link-title">å‘¨åˆŠ</a> <span class="title" style="display:none;">å‘¨åˆŠ</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/11c668/" class="nav-link">å­¦ä¹ å‘¨åˆŠ</a></li><li class="dropdown-item"><!----> <a href="/pages/bcc523/" class="nav-link">Obsidianæ’ä»¶å‘¨åˆŠ</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">å…³äº</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç´¢å¼•" class="dropdown-title"><a href="/categories/" class="link-title">ç´¢å¼•</a> <span class="title" style="display:none;">ç´¢å¼•</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">åˆ†ç±»</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">æ ‡ç­¾</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">å½’æ¡£</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="é¡µé¢" class="dropdown-title"><a href="/friends/" class="link-title">é¡µé¢</a> <span class="title" style="display:none;">é¡µé¢</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">å‹é“¾</a></li><li class="dropdown-item"><!----> <a href="/nav/" class="nav-link">å¯¼èˆª</a></li><li class="dropdown-item"><!----> <a href="/reward/" class="nav-link">æ‰“èµ</a></li><li class="dropdown-item"><!----> <a href="http://m.eryajf.net" target="_blank" rel="noopener noreferrer" class="nav-link external">
  é•œåƒ
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://travellings.link" target="_blank" rel="noopener noreferrer" class="nav-link external">
  å¼€å¾€
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/eryajf/eryajf.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/dengxia.gif"> <div class="blogger-info"><h3>äºŒä¸«è®²æ¢µ</h3> <span>è¡Œè€…å¸¸è‡³ï¼Œä¸ºè€…å¸¸æˆ</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="è¿ç»´" class="dropdown-title"><a href="/ops/" class="link-title">è¿ç»´</a> <span class="title" style="display:none;">è¿ç»´</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/027a17/" class="nav-link">æœ€ä½³å®è·µ</a></li><li class="dropdown-item"><!----> <a href="/pages/29.html" class="nav-link">è¿åˆƒè€Œè§£</a></li><li class="dropdown-item"><!----> <a href="/pages/930.html" class="nav-link">Nginx</a></li><li class="dropdown-item"><!----> <a href="/pages/2782.html" class="nav-link">Php</a></li><li class="dropdown-item"><!----> <a href="/pages/596.html" class="nav-link">Zabbix</a></li><li class="dropdown-item"><!----> <a href="/pages/2468.html" class="nav-link">Prometheus</a></li><li class="dropdown-item"><!----> <a href="/pages/5380.html" class="nav-link">Grafana</a></li><li class="dropdown-item"><!----> <a href="/pages/5279.html" class="nav-link">CentOS</a></li><li class="dropdown-item"><!----> <a href="/pages/1847.html" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/pages/5173.html" class="nav-link">Ansible</a></li><li class="dropdown-item"><!----> <a href="/pages/3410.html" class="nav-link">Ldap</a></li><li class="dropdown-item"><!----> <a href="/pages/243.html" class="nav-link">Gitlab</a></li><li class="dropdown-item"><!----> <a href="/pages/2951.html" class="nav-link">Kafka</a></li><li class="dropdown-item"><!----> <a href="/pages/4050.html" class="nav-link">Etcd</a></li><li class="dropdown-item"><!----> <a href="/pages/f61d95/" class="nav-link">Consul</a></li><li class="dropdown-item"><!----> <a href="/pages/285.html" class="nav-link">Other</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ä¸“é¢˜" class="dropdown-title"><a href="/topic/" class="link-title">ä¸“é¢˜</a> <span class="title" style="display:none;">ä¸“é¢˜</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/2351.html" class="nav-link">ELK</a></li><li class="dropdown-item"><!----> <a href="/pages/1742.html" class="nav-link">K8S</a></li><li class="dropdown-item"><!----> <a href="/pages/45c5da/" class="nav-link">Nexus</a></li><li class="dropdown-item"><!----> <a href="/pages/2415.html" class="nav-link">Jenkins</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç”Ÿæ´»" class="dropdown-title"><a href="/life/" class="link-title">ç”Ÿæ´»</a> <span class="title" style="display:none;">ç”Ÿæ´»</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/2714.html" class="nav-link">éšå†™ç¼–å¹´</a></li><li class="dropdown-item"><!----> <a href="/pages/2442.html" class="nav-link">å®¶äººç‰©è¯­</a></li><li class="dropdown-item"><!----> <a href="/pages/fdb9f6/" class="nav-link">è¿½å¿†é’æ˜¥</a></li><li class="dropdown-item"><!----> <a href="/pages/3993f9/" class="nav-link">çˆ¶äº²çš„æœ‹å‹åœˆ</a></li><li class="dropdown-item"><!----> <a href="/pages/184.html" class="nav-link">ç”µå½±éŸ³ä¹</a></li><li class="dropdown-item"><!----> <a href="/pages/136.html" class="nav-link">æ•ˆç‡å·¥å…·</a></li><li class="dropdown-item"><!----> <a href="/pages/844.html" class="nav-link">åšå®¢ç›¸å…³</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç¼–ç¨‹" class="dropdown-title"><a href="/code/" class="link-title">ç¼–ç¨‹</a> <span class="title" style="display:none;">ç¼–ç¨‹</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/5164.html" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/pages/531.html" class="nav-link">Shell</a></li><li class="dropdown-item"><!----> <a href="/pages/aeab08/" class="nav-link">Golang</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å‘¨åˆŠ" class="dropdown-title"><a href="/pages/11c668/" class="link-title">å‘¨åˆŠ</a> <span class="title" style="display:none;">å‘¨åˆŠ</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/11c668/" class="nav-link">å­¦ä¹ å‘¨åˆŠ</a></li><li class="dropdown-item"><!----> <a href="/pages/bcc523/" class="nav-link">Obsidianæ’ä»¶å‘¨åˆŠ</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">å…³äº</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç´¢å¼•" class="dropdown-title"><a href="/categories/" class="link-title">ç´¢å¼•</a> <span class="title" style="display:none;">ç´¢å¼•</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">åˆ†ç±»</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">æ ‡ç­¾</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">å½’æ¡£</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="é¡µé¢" class="dropdown-title"><a href="/friends/" class="link-title">é¡µé¢</a> <span class="title" style="display:none;">é¡µé¢</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">å‹é“¾</a></li><li class="dropdown-item"><!----> <a href="/nav/" class="nav-link">å¯¼èˆª</a></li><li class="dropdown-item"><!----> <a href="/reward/" class="nav-link">æ‰“èµ</a></li><li class="dropdown-item"><!----> <a href="http://m.eryajf.net" target="_blank" rel="noopener noreferrer" class="nav-link external">
  é•œåƒ
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://travellings.link" target="_blank" rel="noopener noreferrer" class="nav-link external">
  å¼€å¾€
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/eryajf/eryajf.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Nexusç³»åˆ—æ–‡ç« </span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Jenkinsç³»åˆ—æ–‡ç« </span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/2415.html" class="sidebar-link">Jenkinså…¥é—¨ç³»åˆ—ç¬”è®°æ±‡æ€»æ•´ç†</a></li><li><a href="/pages/56.html" class="sidebar-link">å‰è¨€ä¸ä»‹ç»</a></li><li><a href="/pages/63.html" class="sidebar-link">Jenkinsåˆå§‹éƒ¨ç½²ä¸ç®€å•é…ç½®</a></li><li><a href="/pages/77.html" class="sidebar-link">Jenkinså„é…ç½®é€‰é¡¹ä»‹ç»</a></li><li><a href="/pages/85.html" class="sidebar-link">Jenkinsä¸­ä¸€ä¸ªé¡¹ç›®çš„æ„å»º</a></li><li><a href="/pages/104.html" class="sidebar-link">Jenkinsé…ç½®é¡¹ç›®æ„å»ºçš„é’‰é’‰é€šçŸ¥</a></li><li><a href="/pages/106.html" class="sidebar-link">Jenkinså¿˜è®°ç®¡ç†å‘˜å¯†ç æ€ä¹ˆåŠ</a></li><li><a href="/pages/294.html" class="sidebar-link">Jenkinsä¸gitlabçš„äº¤äº’æ¢å¾®</a></li><li><a href="/pages/302.html" class="sidebar-link">Jenkinsæ ¹ç›®å½•è¯¦è§£</a></li><li><a href="/pages/329.html" class="sidebar-link">Jenkinsæ’ä»¶ä¹‹æ˜¾ç¤ºæ„å»ºæ—¶é—´</a></li><li><a href="/pages/334.html" class="sidebar-link">Jenkinsæ’ä»¶ä¹‹æ‰¹é‡ä¿®æ”¹é…ç½®</a></li><li><a href="/pages/342.html" class="sidebar-link">Jenkinsé…ç½®ç®€å•æ„å»ºé‚®ä»¶æ¨é€</a></li><li><a href="/pages/350.html" class="sidebar-link">Jenkinså¤æ‚é‚®ä»¶æ¨é€é…ç½®è¯¦è§£</a></li><li><a href="/pages/374.html" class="sidebar-link">Jenkinsé…ç½®å¤æ‚æ„å»ºé‚®ä»¶æ¨é€</a></li><li><a href="/pages/420.html" class="sidebar-link">Jenkinsæ„å»ºå®‰å“é¡¹ç›®ä¹‹å‰çš„ä¸€äº›å” å¨</a></li><li><a href="/pages/425.html" class="sidebar-link">Jenkinsæ„å»ºå®‰å“é¡¹ç›®é…ç½®</a></li><li><a href="/pages/613.html" class="sidebar-link">Jenkinsä¸Gitlabåˆ†æ”¯çš„äº¤äº’</a></li><li><a href="/pages/639.html" class="sidebar-link">Jenkinsæ„å»ºnodejsé¡¹ç›®</a></li><li><a href="/pages/701.html" class="sidebar-link">ä½¿ç”¨dockeréƒ¨ç½²JenkinsåŠåˆå§‹é…ç½®</a></li><li><a href="/pages/831.html" class="sidebar-link">é…ç½®gitlabæäº¤ä»£ç Jenkinsè‡ªåŠ¨æ„å»º</a></li><li><a href="/pages/1404.html" class="sidebar-link">Jenkinså›æ»šæ–¹æ¡ˆæ¢å¾®</a></li><li><a href="/pages/1445.html" class="sidebar-link">Jenkinsè§’è‰²æ§åˆ¶ï¼ˆå°é»„é”ï¼‰æ¢å¾®</a></li><li><a href="/pages/1626.html" class="sidebar-link">Jenkinsæ„å»ºçš„åº”ç”¨é…ç½®é—®é¢˜è§£å†³æ¢å¾®</a></li><li><a href="/pages/1676.html" class="sidebar-link">Jenkinsæ„å»ºä¸­tagçš„åº”ç”¨</a></li><li><a href="/pages/1786.html" class="sidebar-link">Jenkinsæ’ä»¶ä¹‹Ansicolor(ç¥å™¨)</a></li><li><a href="/pages/1919.html" class="sidebar-link">æœ€åŸºç¡€æ ¸å¿ƒçš„JenkinsåŠŸèƒ½éƒ¨ç½²ä¸€ä¸ªjavaåº”ç”¨</a></li><li><a href="/pages/1977.html" class="sidebar-link">Jenkins+sonaræ„å»ºä»£ç æ‰«æ</a></li><li><a href="/pages/2036.html" class="sidebar-link">Jenkins+docker+gitlabå°†åº”ç”¨éƒ¨ç½²åˆ°docker</a></li><li><a href="/pages/2075.html" class="sidebar-link">Jenkinså‚æ•°åŒ–æ„å»ºçŠ€åˆ©æ’ä»¶Active-Choices-Plugin</a></li><li><a href="/pages/2274.html" class="sidebar-link">è®°ä¸€æ¬¡å°†ä»£ç ä¸­å‚æ•°å¤–æ˜¾åˆ°æ„å»ºå†å²ä¸­çš„æ“ä½œ</a></li><li><a href="/pages/2705.html" class="sidebar-link">Jenkinså‡çº§ä¸è¿ç§»çš„ç»éªŒåˆ†äº«</a></li><li><a href="/pages/3292.html" class="sidebar-link">pipelineç¬”è®°ä¹‹ä»ä¸€ä¸ªç®€å•çš„é¡¹ç›®æ„å»ºå¼€å§‹</a></li><li><a href="/pages/3298.html" aria-current="page" class="active sidebar-link">Jenkinsfileå£°æ˜å¼è¯­æ³•è¯¦è§£</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/3298.html#_1-æ¡†æ¶ä»‹ç»ã€‚" class="sidebar-link">1ï¼Œæ¡†æ¶ä»‹ç»ã€‚</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/3298.html#_1-pipelineã€‚" class="sidebar-link">1ï¼Œpipelineã€‚</a></li><li class="sidebar-sub-header level3"><a href="/pages/3298.html#_2-angetã€‚" class="sidebar-link">2ï¼Œangetã€‚</a></li><li class="sidebar-sub-header level4"><a href="/pages/3298.html#_1-å¸¸è§„ç”¨æ³•ã€‚" class="sidebar-link">1ï¼Œå¸¸è§„ç”¨æ³•ã€‚</a></li><li class="sidebar-sub-header level4"><a href="/pages/3298.html#_2-æ·»åŠ å‚æ•°ã€‚" class="sidebar-link">2ï¼Œæ·»åŠ å‚æ•°ã€‚</a></li><li class="sidebar-sub-header level4"><a href="/pages/3298.html#_3-å¤šä¸ªå®¹å™¨ã€‚" class="sidebar-link">3ï¼Œå¤šä¸ªå®¹å™¨ã€‚</a></li><li class="sidebar-sub-header level4"><a href="/pages/3298.html#_4-åŸºäºdockerfileã€‚" class="sidebar-link">4ï¼ŒåŸºäºDockerfileã€‚</a></li><li class="sidebar-sub-header level3"><a href="/pages/3298.html#_3-environment" class="sidebar-link">3ï¼Œenvironment</a></li><li class="sidebar-sub-header level3"><a href="/pages/3298.html#_4-stages" class="sidebar-link">4ï¼Œstages</a></li><li class="sidebar-sub-header level3"><a href="/pages/3298.html#_5-stage" class="sidebar-link">5ï¼Œstage</a></li><li class="sidebar-sub-header level3"><a href="/pages/3298.html#_6-steps" class="sidebar-link">6ï¼Œsteps</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/3298.html#_2-ä¸»è¦å‚æ•°ã€‚" class="sidebar-link">2ï¼Œä¸»è¦å‚æ•°ã€‚</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/3298.html#_1-options" class="sidebar-link">1ï¼Œoptions</a></li><li class="sidebar-sub-header level3"><a href="/pages/3298.html#_2-post" class="sidebar-link">2ï¼Œpost</a></li><li class="sidebar-sub-header level3"><a href="/pages/3298.html#_3-tools" class="sidebar-link">3ï¼Œtools</a></li><li class="sidebar-sub-header level3"><a href="/pages/3298.html#_4-parameters" class="sidebar-link">4ï¼Œparameters</a></li><li class="sidebar-sub-header level3"><a href="/pages/3298.html#_5-input" class="sidebar-link">5ï¼Œinput</a></li><li class="sidebar-sub-header level3"><a href="/pages/3298.html#_6-when" class="sidebar-link">6ï¼Œwhen</a></li><li class="sidebar-sub-header level4"><a href="/pages/3298.html#_1-branch" class="sidebar-link">1ï¼Œbranch</a></li><li class="sidebar-sub-header level4"><a href="/pages/3298.html#_2-environment" class="sidebar-link">2ï¼Œenvironment</a></li><li class="sidebar-sub-header level4"><a href="/pages/3298.html#_3-not" class="sidebar-link">3ï¼Œnot</a></li><li class="sidebar-sub-header level4"><a href="/pages/3298.html#_4-allof" class="sidebar-link">4ï¼ŒallOf</a></li><li class="sidebar-sub-header level4"><a href="/pages/3298.html#_5-anyof" class="sidebar-link">5ï¼ŒanyOf</a></li><li class="sidebar-sub-header level4"><a href="/pages/3298.html#_6-beforeagent" class="sidebar-link">6ï¼ŒbeforeAgent</a></li><li class="sidebar-sub-header level4"><a href="/pages/3298.html#_7-expression" class="sidebar-link">7ï¼Œexpression</a></li><li class="sidebar-sub-header level4"><a href="/pages/3298.html#_8-changelog" class="sidebar-link">8ï¼Œchangelog</a></li><li class="sidebar-sub-header level4"><a href="/pages/3298.html#_9-changeset" class="sidebar-link">9ï¼Œchangeset</a></li><li class="sidebar-sub-header level4"><a href="/pages/3298.html#_10-equals" class="sidebar-link">10ï¼Œequals</a></li><li class="sidebar-sub-header level4"><a href="/pages/3298.html#_11-tag" class="sidebar-link">11ï¼Œtag</a></li><li class="sidebar-sub-header level4"><a href="/pages/3298.html#_12-triggeredby" class="sidebar-link">12ï¼ŒtriggeredBy</a></li><li class="sidebar-sub-header level3"><a href="/pages/3298.html#_7-triggers" class="sidebar-link">7ï¼Œtriggers</a></li><li class="sidebar-sub-header level4"><a href="/pages/3298.html#_1-cron" class="sidebar-link">1ï¼Œcron</a></li><li class="sidebar-sub-header level4"><a href="/pages/3298.html#_2-pollscm" class="sidebar-link">2ï¼ŒpollSCM</a></li><li class="sidebar-sub-header level4"><a href="/pages/3298.html#_3-upstream" class="sidebar-link">3ï¼Œupstream</a></li><li class="sidebar-sub-header level4"><a href="/pages/3298.html#_4-gitlabäº‹ä»¶è§¦å‘ã€‚" class="sidebar-link">4ï¼Œgitlabäº‹ä»¶è§¦å‘ã€‚</a></li><li class="sidebar-sub-header level3"><a href="/pages/3298.html#_8-parallel" class="sidebar-link">8ï¼Œparallel</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/3298.html#_3-å…¶ä»–å‚æ•°" class="sidebar-link">3ï¼Œå…¶ä»–å‚æ•°</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/3298.html#_1-sh" class="sidebar-link">1ï¼Œsh</a></li><li class="sidebar-sub-header level3"><a href="/pages/3298.html#_2-deletedir" class="sidebar-link">2ï¼ŒdeleteDir</a></li><li class="sidebar-sub-header level3"><a href="/pages/3298.html#_3-dirã€‚" class="sidebar-link">3ï¼Œdirã€‚</a></li><li class="sidebar-sub-header level3"><a href="/pages/3298.html#_4-fileexists" class="sidebar-link">4ï¼ŒfileExists</a></li><li class="sidebar-sub-header level3"><a href="/pages/3298.html#_5-error" class="sidebar-link">5ï¼Œerror</a></li><li class="sidebar-sub-header level3"><a href="/pages/3298.html#_6-timeout" class="sidebar-link">6ï¼Œtimeout</a></li><li class="sidebar-sub-header level3"><a href="/pages/3298.html#_7-waitutil" class="sidebar-link">7ï¼ŒwaitUtil</a></li><li class="sidebar-sub-header level3"><a href="/pages/3298.html#_8-retry" class="sidebar-link">8ï¼Œretry</a></li><li class="sidebar-sub-header level3"><a href="/pages/3298.html#_9-sleep" class="sidebar-link">9ï¼Œsleep</a></li><li class="sidebar-sub-header level3"><a href="/pages/3298.html#_10-try-catch" class="sidebar-link">10ï¼Œtry&amp;catch</a></li><li class="sidebar-sub-header level3"><a href="/pages/3298.html#_11-docker" class="sidebar-link">11ï¼Œdocker</a></li><li class="sidebar-sub-header level4"><a href="/pages/3298.html#_1-æ„å»ºå®¹å™¨" class="sidebar-link">1ï¼Œæ„å»ºå®¹å™¨</a></li><li class="sidebar-sub-header level4"><a href="/pages/3298.html#_2-ä½¿ç”¨è‡ªå®šä¹‰æ³¨å†Œè¡¨" class="sidebar-link">2ï¼Œä½¿ç”¨è‡ªå®šä¹‰æ³¨å†Œè¡¨</a></li><li class="sidebar-sub-header level4"><a href="/pages/3298.html#_3-è¿è¡Œ-sidecar-å®¹å™¨" class="sidebar-link">3ï¼Œè¿è¡Œ &quot;sidecar&quot; å®¹å™¨</a></li><li class="sidebar-sub-header level3"><a href="/pages/3298.html#_12-withenv" class="sidebar-link">12ï¼ŒwithEnv</a></li></ul></li></ul></li><li><a href="/pages/3304.html" class="sidebar-link">è‡ªåŠ¨æ„å»ºçš„åŸå§‹é…ç½®ä»¥åŠpipelineä¸­çš„ç”¨æ³•</a></li><li><a href="/pages/3306.html" class="sidebar-link">å¤šåˆ†æ”¯æ„å»ºçš„å®è·µä¸æ€è€ƒ</a></li><li><a href="/pages/3352.html" class="sidebar-link">ä½¿ç”¨Jenkinsfileç±»å‰ç«¯é¡¹ç›®çš„éƒ¨ç½²ä¸å›æ»š</a></li><li><a href="/pages/3491.html" class="sidebar-link">å¦‚ä½•åœ¨Jenkinsfileä¸­å®šä¹‰ä¸€ä¸ªå…¨å±€çš„æ—¶é—´æˆ³å˜é‡</a></li><li><a href="/pages/3508.html" class="sidebar-link">Jenkinsä¸­è‡ªç”±é£æ ¼å›æ»šæ–¹æ¡ˆçš„æœ€ä½³å®è·µ</a></li><li><a href="/pages/3510.html" class="sidebar-link">Jenkinsä¸­pipelineé£æ ¼å›æ»šæ–¹æ¡ˆçš„æœ€ä½³å®è·µ</a></li><li><a href="/pages/3512.html" class="sidebar-link">pipelineç»“åˆansibleå‰§æœ¬è¿›è¡Œæ‰¹é‡çš„éƒ¨ç½²ä¸å›æ»šé…ç½®</a></li><li><a href="/pages/3514.html" class="sidebar-link">æœ€è¿‘é…ç½®å®‰å“iOSæ‰“åŒ…æœ¬åœ°åŒ–æµç¨‹ä¸­ä¸€äº›å€¼å¾—è®°å½•çš„å†…å®¹</a></li><li><a href="/pages/5140.html" class="sidebar-link">pipelineä¸­å¦‚ä½•åœ¨environmentç¯èŠ‚å£°æ˜ä¸€ä¸ªå«æœ‰é€šé…ç¬¦çš„å˜é‡</a></li><li><a href="/pages/5328.html" class="sidebar-link">git-Parameteræ’ä»¶åœ¨pipelineå…±äº«åº“ä¸­çš„å®è·µè¯¦è§£</a></li><li><a href="/pages/615b71/" class="sidebar-link">jenkinsä½œä¸ºciæ£€æµ‹ä»£ç æ˜¯å¦åˆå¹¶çš„å®è·µ</a></li><li><a href="/pages/b732f5/" class="sidebar-link">å°†Jenkinså…±äº«åº“çš„Jenkinsfileæ”¾åˆ°cié™æ€æ£€æµ‹çš„å®è·µ</a></li><li><a href="/pages/ff3332/" class="sidebar-link">Jenkinsçš„pipelineå®è·µä¹‹GitSCMå‚æ•°é…ç½®é¡¹è¯¦è§£</a></li><li><a href="/pages/73a9c5/" class="sidebar-link">Jenkinsä¸­pipelineå¯¹æ¥CMDBæ¥å£è·å–ä¸»æœºåˆ—è¡¨çš„å‘å¸ƒå®è·µ</a></li><li><a href="/pages/218713/" class="sidebar-link">Jenkinsæœ‰ä»»åŠ¡æ— æ³•killæç¤ºå³å°†å…³é—­</a></li><li><a href="/pages/2280.html" class="sidebar-link">Jenkinså¸¸ç”¨æ’ä»¶æ±‡æ€»ä»¥åŠç®€å•ä»‹ç»</a></li><li><a href="/pages/562.html" class="sidebar-link">Jenkinsæ‰€é‡æŠ¥é”™æ±‡æ€»åŠè§£å†³</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ELKç¬”è®°</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Kubernetesç¬”è®°</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-0c557b5e><div class="articleInfo" data-v-0c557b5e><ul class="breadcrumbs" data-v-0c557b5e><li data-v-0c557b5e><a href="/" title="é¦–é¡µ" class="iconfont icon-home router-link-active" data-v-0c557b5e></a></li> <li data-v-0c557b5e><a href="/categories/?category=%E7%B3%BB%E5%88%97%E4%B8%93%E9%A2%98" title="åˆ†ç±»" data-v-0c557b5e>ç³»åˆ—ä¸“é¢˜</a></li><li data-v-0c557b5e><a href="/categories/?category=Jenkins%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0" title="åˆ†ç±»" data-v-0c557b5e>Jenkinsç³»åˆ—æ–‡ç« </a></li></ul> <div class="info" data-v-0c557b5e><div title="ä½œè€…" class="author iconfont icon-touxiang" data-v-0c557b5e><a href="https://github.com/eryajf" target="_blank" title="ä½œè€…" class="beLink" data-v-0c557b5e>äºŒä¸«è®²æ¢µ</a></div> <div title="åˆ›å»ºæ—¶é—´" class="date iconfont icon-riqi" data-v-0c557b5e><a href="javascript:;" data-v-0c557b5e>2019-09-15</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">ç›®å½•</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">Jenkinsfileå£°æ˜å¼è¯­æ³•è¯¦è§£<span class="title-tag">åŸåˆ›</span></h1>  <div class="theme-vdoing-content content__default"><p>ä¸Šç¯‡æ–‡ç« å¯¹Jenkins pipelineå…¥é—¨åšäº†ç®€å•ä»‹ç»ï¼Œç®€å•è§è¯†äº†Jenkinsfileå½“ä¸­çš„å‡ ä¸ªå¸¸ç”¨çš„è¯­æ³•å…³é”®å­—ï¼Œæœ¬æ–‡å°†é’ˆå¯¹å£°æ˜å¼çš„è¯­æ³•è¿›è¡Œè¯¦ç»†è§£è¯»ï¼Œè¿™ç§è§£è¯»å°†ä¼šæ˜¯æ‰‹å†Œæ€§è´¨çš„ï¼Œä¼šæœ‰è®²è§£ï¼Œå¿…è¦çš„ä¹Ÿä¼šæœ‰ç®€å•å®éªŒæ¼”ç¤ºï¼Œä½†æ˜¯å¹¶ä¸ä¼šåšå®Œæ•´é¡¹ç›®æµç¨‹çš„ä»‹ç»ã€‚</p> <p>æ‰‹å†Œæ€§è´¨çš„æ•´ç†ï¼Œæ˜¯ä¸ºäº†æ–¹ä¾¿ä»¥åç”¨èµ·æ¥ä¹‹åï¼ŒæŸ¥è¯¢æ–¹ä¾¿ã€‚æˆ‘ä¸ªäººä¹Ÿå¸¸å¸¸å› ä¸ºé‡åˆ°ä¸€äº›é™Œç”Ÿçš„å‚æ•°ï¼Œæˆ–è€…ä¸ç†Ÿæ‚‰çš„ç”¨æ³•ï¼Œåˆ°ç½‘ä¸Šå„ç§æ‰¾ï¼Œæ£€ç´¢åˆ°çš„ç»“æœå¾€å¾€ä¹Ÿéƒ½ä¸ååˆ†æ»¡æ„ï¼Œå› æ­¤è¿™ç¯‡æ–‡ç« ï¼Œä¼šå°½é‡è¯¦ç»†è®°å½•å„ä¸ªæŒ‡ä»¤çš„å‚æ•°é¡¹ã€‚</p> <h2 id="_1-æ¡†æ¶ä»‹ç»ã€‚"><a href="#_1-æ¡†æ¶ä»‹ç»ã€‚" class="header-anchor">#</a> 1ï¼Œæ¡†æ¶ä»‹ç»ã€‚</h2> <p>ä¸€ä¸ªå¸¸è§„çš„å£°æ˜å¼Jenkinsfileï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæœ‰å¦‚ä¸‹å¸¸è§„æ¡†æ¶ï¼Œè¿™ä¸ªæ¡†æ¶åŸºæœ¬ä¸Šæ¯ä¸ªç¯èŠ‚éƒ½æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œæ‰€ä»¥æˆ‘å°±ä»å¤–åˆ°å†…ï¼Œå…ˆä»æ•´ä½“æ¡†æ¶è®²èµ·ã€‚å›¾ç¤ºå¦‚ä¸‹ï¼š</p> <p><img src="http://t.eryajf.net/imgs/2021/09/f126d7d667e038cd.jpg" alt="image-20200111205506591"></p> <p>è€Œå½“æˆ‘ä»¬åœ¨vscodeå½“ä¸­å®‰è£…äº†Jenkins pipelineæ’ä»¶çš„ä¹‹åï¼Œè¾“å…¥pipeç„¶åå›è½¦ï¼Œé»˜è®¤è‡ªåŠ¨è¡¥å…¨å‡ºæ¥çš„å†…å®¹å¦‚ä¸‹ï¼š</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>pipeline<span class="token punctuation">{</span>
    agent<span class="token punctuation">{</span>
        label <span class="token string gstring">&quot;node&quot;</span>
    <span class="token punctuation">}</span>
    stages<span class="token punctuation">{</span>
        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string gstring">&quot;A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            steps<span class="token punctuation">{</span>
                echo <span class="token string gstring">&quot;========executing A========&quot;</span>
            <span class="token punctuation">}</span>
            post<span class="token punctuation">{</span>
                always<span class="token punctuation">{</span>
                    echo <span class="token string gstring">&quot;========always========&quot;</span>
                <span class="token punctuation">}</span>
                success<span class="token punctuation">{</span>
                    echo <span class="token string gstring">&quot;========A executed successfully========&quot;</span>
                <span class="token punctuation">}</span>
                failure<span class="token punctuation">{</span>
                    echo <span class="token string gstring">&quot;========A execution failed========&quot;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    post<span class="token punctuation">{</span>
        always<span class="token punctuation">{</span>
            echo <span class="token string gstring">&quot;========always========&quot;</span>
        <span class="token punctuation">}</span>
        success<span class="token punctuation">{</span>
            echo <span class="token string gstring">&quot;========pipeline executed successfully ========&quot;</span>
        <span class="token punctuation">}</span>
        failure<span class="token punctuation">{</span>
            echo <span class="token string gstring">&quot;========pipeline execution failed========&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>ç°åœ¨å°±åŸºäºè¿™ä¸ªåŸºç¡€æ¡†æ¶ï¼Œä»‹ç»ä¸€ä¸‹å„ä¸ªç»„ä»¶ï¼Œå› ä¸ºè¿™äº›åœ¨ä¸Šç¯‡æ–‡ç« åŸºæœ¬ä¸Šéƒ½ä»‹ç»è¿‡ï¼Œæ‰€ä»¥ç•¥äººæ‰€è¯¦åœ°è¿›è¡Œä¸€ä¸‹è®²è§£ã€‚</p> <h3 id="_1-pipelineã€‚"><a href="#_1-pipelineã€‚" class="header-anchor">#</a> 1ï¼Œpipelineã€‚</h3> <p>ç”¨äºå£°æ˜è¡¨ç¤ºæµæ°´çº¿çš„æ ‡è¯†ï¼Œè¡¨ç¤ºè¿™é‡Œå°†é‡‡ç”¨å£°æ˜å¼çš„è¯­æ³•é£æ ¼ã€‚å¹¶ä¸åŒ…å«ä»€ä¹ˆç‰¹æ®Šæ„ä¹‰ã€‚</p> <h3 id="_2-angetã€‚"><a href="#_2-angetã€‚" class="header-anchor">#</a> 2ï¼Œangetã€‚</h3> <p>æ­¤å…³é”®å­—ç”¨äºè¡¨ç¤ºå½“å‰æµæ°´çº¿å°†è¦æ‰§è¡Œçš„ä½ç½®ï¼Œå½“æˆ‘ä»¬çš„Jenkinsæ˜¯ä¸»ä»é‚£ç§é›†ç¾¤çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡agentè¿›è¡ŒæŒ‡å®šï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥åŸºäºdockerå®¹å™¨çš„æ„å»ºï¼Œå› ä¸ºç°åœ¨ä¸€åˆ‡éƒ½æ˜¯å®¹å™¨åŒ–çš„æ—¶ä»£ï¼Œæ‰€ä»¥è¿™é‡Œå°±åŸºäºå®¹å™¨çš„è¿™ç§æ–¹å¼ç¨å¾®å±•å¼€è®²ä¸€ä¸‹ï¼Œä»‹ç»ä¸€ä¸‹ç”¨æ³•ï¼Œä»¥åå¯èƒ½ä¼šä¸“é—¨ç”¨ä¸€ç¯‡æ–‡ç« å±•å¼€è¯¦è§£ä¸€ä¸‹å¦™ç”¨ã€‚</p> <h4 id="_1-å¸¸è§„ç”¨æ³•ã€‚"><a href="#_1-å¸¸è§„ç”¨æ³•ã€‚" class="header-anchor">#</a> 1ï¼Œå¸¸è§„ç”¨æ³•ã€‚</h4> <p>æ—¥å¸¸æ„å»ºéƒ¨ç½²ä¸­ï¼Œå¸¸å¸¸ä¼šç”¨åˆ°ç¼–è¯‘å·¥ä½œï¼Œå› æ­¤è¿™é‡Œçš„æ­¥éª¤å¯ä»¥æ”¾å…¥åˆ°é•œåƒä¸­æ‰§è¡Œï¼Œè¿™é‡Œåˆ©ç”¨nodeé¡¹ç›®çš„ç¼–è¯‘ä¸¾ä¸€ä¸ªç¤ºä¾‹ï¼š</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>pipeline <span class="token punctuation">{</span>
    agent <span class="token punctuation">{</span>
        docker <span class="token punctuation">{</span>
        		lable <span class="token string">'docker'</span>
            image <span class="token string">'registry.cn-hangzhou.aliyuncs.com/eryajf/node:11.15'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    stages <span class="token punctuation">{</span>
        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'Build'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
            steps <span class="token punctuation">{</span>
                sh <span class="token string">'npm install --registry=https://registry.npm.taobao.org'</span> 
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>å½“æµæ°´çº¿æ‰§è¡Œçš„æ—¶å€™ï¼ŒJenkinsä¼šé¦–å…ˆå°†ä»£ç æ›´æ–°ï¼Œç„¶åå°† <code>$WORKSPACE</code> æŒ‚è½½åˆ°å®¹å™¨ä¹‹ä¸­ï¼Œè¿™ä¸ªå¯ä»¥é€šè¿‡æ„å»ºæ—¥å¿—ä¸­çœ‹å‡ºæ¥ï¼š</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">docker</span> run -t -d -u <span class="token number">0</span>:0 -w /root/.jenkins/workspace/test-pinpeline -v /root/.jenkins/workspace/test-pinpeline:/root/.jenkins/workspace/test-pinpeline:rw,z -v /root/.jenkins/workspace/test-pinpeline@tmp:/root/.jenkins/workspace/test-pinpeline@tmp:rw,z -e ******** registry.cn-hangzhou.aliyuncs.com/eryajf/node:11.15
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>æ¥ç€æ‰§è¡Œæˆ‘ä»¬å®šä¹‰çš„installç¼–è¯‘å‘½ä»¤ï¼Œå½“ç„¶ï¼Œä¸‹è¾¹å¯ä»¥ç»§ç»­æ·»åŠ æ­¥éª¤ï¼Œå°†ä»£ç rsyncåˆ°è¿œç¨‹ä¸»æœºï¼Œæˆ–è€…å…¶ä»–æ“ä½œã€‚</p> <p>æ­¤å¤„å¯ç”¨çš„å‚æ•°å¦‚ä¸‹ï¼š</p> <ul><li>lableï¼ˆå¯é€‰ï¼‰ï¼šå®šä¹‰ä¸€ä¸ªæ ‡ç­¾ï¼Œç”¨å¤„ä¸ååˆ†å¤§ã€‚</li> <li>imageï¼šå®šä¹‰æ„å»ºæ—¶ä½¿ç”¨çš„é•œåƒã€‚</li> <li>argsï¼šå¯ä»¥å®šä¹‰ç±»ä¼¼docker runå‘½ä»¤æ—¶çš„ä¸€äº›å‚æ•°ã€‚</li> <li>alwaysPullï¼šå¸ƒå°”ç±»å‹ï¼Œæ˜¯å¦åœ¨æ¯æ¬¡è¿è¡Œçš„æ—¶å€™é‡æ–°æ‹‰å–é•œåƒã€‚</li></ul> <h4 id="_2-æ·»åŠ å‚æ•°ã€‚"><a href="#_2-æ·»åŠ å‚æ•°ã€‚" class="header-anchor">#</a> 2ï¼Œæ·»åŠ å‚æ•°ã€‚</h4> <p>æ—¥å¸¸ç¼–è¯‘æ¯”è¾ƒå½±å“æ„å»ºæ—¶é—´çš„ä¸€ä¸ªå› ç´ æ˜¯æœ¬åœ°ç¼“å­˜ï¼Œå› æ­¤è¿˜å¯ä»¥ç”¨å¦‚ä¸‹æ–¹å¼å°†æœ¬åœ°ç¼“å­˜æŒ‚è½½åˆ°å®¹å™¨ä¹‹ä¸­ï¼Œä»è€ŒåŠ å¿«æ„å»ºé€Ÿåº¦ã€‚</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>pipeline <span class="token punctuation">{</span>
    agent <span class="token punctuation">{</span>
        docker <span class="token punctuation">{</span>
            image <span class="token string">'registry.cn-hangzhou.aliyuncs.com/eryajf/node:11.15'</span>
            args <span class="token string">'-v /root/.npm:/root/.npm'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    stages <span class="token punctuation">{</span>
        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'Build'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
            steps <span class="token punctuation">{</span>
                sh <span class="token string">'npm install --registry=https://registry.npm.taobao.org'</span> 
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="_3-å¤šä¸ªå®¹å™¨ã€‚"><a href="#_3-å¤šä¸ªå®¹å™¨ã€‚" class="header-anchor">#</a> 3ï¼Œå¤šä¸ªå®¹å™¨ã€‚</h4> <p>åŸºäºå¦‚ä¸Šçš„äº‹å®ï¼Œå‘æ•£æˆ‘ä»¬çš„æ€ç»´ï¼Œæˆ‘ä»¬å¯ä»¥å°†è®¸å¤šä¸ªåŸºç¡€æ€§çš„æ­¥éª¤ï¼Œå°è£…æˆä¸€ä¸ªåˆä¸€ä¸ªé•œåƒï¼Œç„¶ååœ¨æ¯ä¸ªæ­¥éª¤ä¸­åªéœ€è°ƒç”¨å°è£…å¥½çš„é•œåƒï¼Œä¼ å…¥æ‰€éœ€çš„å‚æ•°ï¼Œå³å¯å®Œæˆæ¯”è¾ƒå¤æ‚çš„æ„å»ºã€‚</p> <p>å¤šä¸ªå®¹å™¨ç”¨æ³•ï¼Œå¦‚ä¸‹ç®€ç¤ºï¼š</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>pipeline <span class="token punctuation">{</span>
    agent none
    stages <span class="token punctuation">{</span>
        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'Build'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
            agent <span class="token punctuation">{</span>
                docker <span class="token punctuation">{</span>
                    image <span class="token string">'registry.cn-hangzhou.aliyuncs.com/eryajf/node:11.15'</span>
                    args <span class="token string">'-v /root/.npm:/root/.npm'</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            steps <span class="token punctuation">{</span>
                sh <span class="token string">'npm install --registry=https://registry.npm.taobao.org'</span> 
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'deploy'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            agent <span class="token punctuation">{</span>
                docker <span class="token punctuation">{</span>
                    image <span class="token string">'registry.cn-hangzhou.aliyuncs.com/mckj/ansible'</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            steps <span class="token punctuation">{</span>
                sh <span class="token string">'echo &quot;é€šè¿‡ansbileè¿›è¡Œéƒ¨ç½²&quot;'</span> 
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>å› ä¸ºJenkinsé»˜è®¤ä¼šå°†<code>$WORKSPACE</code>æŒ‚è½½åˆ°ä¸¤ä¸ªå®¹å™¨ä¸­ï¼Œå› æ­¤å„ç§æ“ä½œç›´æ¥åŸºäºå½“å‰ç›®å½•å³å¯ï¼Œè¿™æ˜¯å€¼å¾—æ³¨æ„çš„ä¸€ç‚¹ã€‚</p> <p>è¿™é‡Œåªæ˜¯åšä¸€ä¸ªæ¼”ç¤ºï¼Œæä¾›ä¸€ç§æ€è·¯ï¼Œä»¥åæœ‰éœ€è¦ï¼Œå¯ä»¥å€Ÿæ­¤å‘æŒ¥æ›´å¤šçš„å¦™ç”¨ã€‚</p> <h4 id="_4-åŸºäºdockerfileã€‚"><a href="#_4-åŸºäºdockerfileã€‚" class="header-anchor">#</a> 4ï¼ŒåŸºäºDockerfileã€‚</h4> <p>è¿™ç§æ–¹å¼ï¼Œåº”ç”¨çš„å¤§æ¦‚æ¯”è¾ƒå°‘ï¼Œä»…åšç®€å•ä»‹ç»ã€‚</p> <p>é¦–å…ˆåœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ªDockerfileï¼š</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">FROM</span>       eryajf/centos:7.5</span>
<span class="token instruction"><span class="token keyword">MAINTAINER</span> eryajf &lt;Linuxlql@163.com&gt;</span>

<span class="token comment"># Install node</span>
<span class="token instruction"><span class="token keyword">ADD</span>  node-v11.15.0-linux-x64.tar.xz   /usr/local/</span>

<span class="token instruction"><span class="token keyword">ENV</span> NODE /usr/local/node-v11.15.0-linux-x64</span>
<span class="token instruction"><span class="token keyword">ENV</span> PATH <span class="token variable">$PATH</span>:<span class="token variable">$NODE</span>/bin</span>

<span class="token instruction"><span class="token keyword">RUN</span> npm i -g pm2 gulp yarn --registry=https://registry.npm.taobao.org</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>ç„¶åå®šä¹‰Jenkinsfileï¼š</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>pipeline <span class="token punctuation">{</span>
    agent <span class="token punctuation">{</span> dockerfile <span class="token boolean">true</span> <span class="token punctuation">}</span>
    stages <span class="token punctuation">{</span>
        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'Build'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
            steps <span class="token punctuation">{</span>
                sh <span class="token string">'npm install --registry=https://registry.npm.taobao.org'</span> 
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>æ„Ÿè§‰èµ·æ¥ï¼Œè¿™ç§æ–¹å¼å¼•å…¥äº†è¿‡å¤šçš„ä¸ç¡®å®šå› ç´ ï¼Œå¯¹äºæ„å»ºç¨³å®šæ€§ï¼Œåè€Œä¸æ˜¯ä¸€ä»¶å¥½äº‹å„¿ï¼Œæ‰€ä»¥ä¸å¤ªæ¨èã€‚</p> <h3 id="_3-environment"><a href="#_3-environment" class="header-anchor">#</a> 3ï¼Œenvironment</h3> <p>ç”¨äºè®¾ç½®ç¯å¢ƒå˜é‡ï¼Œä»¥ä¾¿äºä»£ç å¤ç”¨çš„æ—¶å€™ï¼Œæ›´åŠ æ¸…æ™°æ˜äº†çš„ç®€åŒ–å·¥ä½œå†…å®¹ï¼Œåªè¦é¡¹ç›®æ˜¯ç±»ä¼¼çš„ï¼Œé‚£ä¹ˆç›´æ¥åœ¨ <code>environment</code>åŒºåŸŸè¿›è¡Œé…ç½®å³å¯ï¼Œè€Œæ— éœ€ç©¿æ¢­åˆ°å¤æ‚çš„å†…å®¹é‡Œæ›´æ”¹é…ç½®ã€‚éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå˜é‡çš„å£°æ˜å¯ä»¥åœ¨pipelineä»¥åŠstageåŒºåŸŸå½“ä¸­ï¼Œä¸å¤§å¤šæ•°è¯­è¨€ä¸€æ ·ï¼Œä¸åŒçš„åŒºåŸŸä½œç”¨åŸŸä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ã€‚</p> <h3 id="_4-stages"><a href="#_4-stages" class="header-anchor">#</a> 4ï¼Œstages</h3> <p>æ­¤å…³é”®å­—ç”¨äºè¡¨ç¤ºæµæ°´çº¿å„ä¸ªæ­¥éª¤çš„å£°æ˜ï¼Œå…¶ä¸‹ä¸€å±‚çº§æ˜¯stageï¼Œstageséƒ¨åˆ†è‡³å°‘åŒ…å«ä¸€ä¸ªstageã€‚</p> <h3 id="_5-stage"><a href="#_5-stage" class="header-anchor">#</a> 5ï¼Œstage</h3> <p>è¡¨ç¤ºå®é™…æ„å»ºçš„é˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µåšä¸åŒçš„äº‹æƒ…ï¼Œå¯æŒ‰å¦‚ä¸Šæ–¹å¼å®šä¹‰é˜¶æ®µçš„åç§°ã€‚</p> <h3 id="_6-steps"><a href="#_6-steps" class="header-anchor">#</a> 6ï¼Œsteps</h3> <p>æ ‡è¯†é˜¶æ®µä¹‹ä¸­å…·ä½“çš„æ„å»ºæ­¥éª¤ï¼Œè‡³å°‘åŒ…å«ä¸€ä¸ªæ­¥éª¤ï¼Œåœ¨stageä¸­æœ‰ä¸”åªèƒ½æœ‰ä¸€ä¸ªstepsã€‚</p> <h2 id="_2-ä¸»è¦å‚æ•°ã€‚"><a href="#_2-ä¸»è¦å‚æ•°ã€‚" class="header-anchor">#</a> 2ï¼Œä¸»è¦å‚æ•°ã€‚</h2> <h3 id="_1-options"><a href="#_1-options" class="header-anchor">#</a> 1ï¼Œoptions</h3> <p>ç”¨æ¥é…ç½®Jenkinsåº”ç”¨è‡ªèº«çš„ä¸€äº›é…ç½®é¡¹ï¼Œå¸¸ç”¨çš„å‚æ•°æœ‰å¦‚ä¸‹ï¼Œå¯æ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œé€‰ç”¨ã€‚</p> <ul><li><p>buildDiscarder</p> <p>ä¿å­˜æœ€è¿‘å†å²æ„å»ºè®°å½•çš„æ•°é‡ï¼Œæ¯”è¾ƒç†Ÿæ‚‰Jenkinsçš„ç«¥é‹åº”è¯¥æ˜ç™½è¿™ä¸ªå‚æ•°çš„æ„ä¹‰ï¼Œå¯ä»¥æœ‰æ•ˆæ§åˆ¶Jenkinsä¸»æœºå­˜å‚¨ç©ºé—´ã€‚</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>options <span class="token punctuation">{</span>
		<span class="token comment">// è¡¨ç¤ºä¿ç•™10æ¬¡æ„å»ºå†å²</span>
		<span class="token function">buildDiscarder</span><span class="token punctuation">(</span><span class="token function">logRotator</span><span class="token punctuation">(</span>numToKeepStr<span class="token punctuation">:</span> <span class="token string">'10'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>disableConcurrentBuilds</p> <p>ä¸å…è®¸åŒæ—¶æ‰§è¡Œæµæ°´çº¿ï¼Œè¢«ç”¨æ¥é˜²æ­¢åŒæ—¶è®¿é—®å…±äº«èµ„æºç­‰ã€‚</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>options <span class="token punctuation">{</span>
		<span class="token function">disableConcurrentBuilds</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>timeout</p> <p>è®¾ç½®é¡¹ç›®æ„å»ºè¶…æ—¶æ—¶é—´ï¼Œå¾ˆæ˜æ˜¾ï¼Œå¦‚æœè¶…æ—¶ï¼Œå°†ä¼šä»¥å¤±è´¥çŠ¶æ€ç»“æŸæ„å»ºã€‚</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>options <span class="token punctuation">{</span>
		<span class="token comment">// è®¾ç½®æµæ°´çº¿è¿è¡Œçš„è¶…è¿‡10åˆ†é’Ÿï¼ŒJenkinså°†ä¸­æ­¢æµæ°´çº¿</span>
		<span class="token function">timeout</span><span class="token punctuation">(</span>time<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> unit<span class="token punctuation">:</span> <span class="token string">'MINUTES'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>åŒç†è¿˜æœ‰å°æ—¶(HOURS)å’Œç§’(SECONDS)ï¼Œå¯æ ¹æ®å®é™…é¡¹ç›®éœ€æ±‚è¿›è¡Œå®šä¹‰ã€‚</p></li> <li><p>timestamps</p> <p>è®¾ç½®åœ¨é¡¹ç›®æ‰“å°æ—¥å¿—æ—¶å¸¦ä¸Šå¯¹åº”æ—¶é—´ã€‚</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>options <span class="token punctuation">{</span>
		<span class="token comment">// è¾“å‡ºæ„å»ºçš„æ—¶é—´ä¿¡æ¯</span>
    <span class="token function">timestamps</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>skipDefaultCheckout</p> <p>åœ¨<code>agent</code> æŒ‡ä»¤ä¸­ï¼Œè·³è¿‡ä»æºä»£ç æ§åˆ¶ä¸­æ£€å‡ºä»£ç çš„é»˜è®¤æƒ…å†µã€‚</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>options <span class="token punctuation">{</span>
		<span class="token comment">// è·³è¿‡é»˜è®¤çš„ä»£ç æ£€å‡º</span>
		<span class="token function">skipDefaultCheckout</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>checkoutToSubdirectory</p> <p>æŒ‡å®šä»£ç æ£€å‡ºåˆ° <code>$WORKSPACE</code>çš„å­ç›®å½•ã€‚</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>options <span class="token punctuation">{</span>
		<span class="token function">checkoutToSubdirectory</span><span class="token punctuation">(</span><span class="token string">'testdir'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>retry</p> <p>åœ¨æ„å»ºå¤±è´¥çš„æ—¶å€™ï¼Œé‡æ–°å°è¯•æ•´ä¸ªæµæ°´çº¿çš„æŒ‡å®šæ¬¡æ•°ã€‚</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>options <span class="token punctuation">{</span>
		<span class="token function">retry</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ul> <p><code>å¸¸ç”¨æ±‡æ€»ï¼š</code></p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>options <span class="token punctuation">{</span>
		<span class="token function">timestamps</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token function">disableConcurrentBuilds</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token function">timeout</span><span class="token punctuation">(</span>time<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> unit<span class="token punctuation">:</span> <span class="token string">'MINUTES'</span><span class="token punctuation">)</span>
    <span class="token function">buildDiscarder</span><span class="token punctuation">(</span><span class="token function">logRotator</span><span class="token punctuation">(</span>numToKeepStr<span class="token punctuation">:</span> <span class="token string">'10'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_2-post"><a href="#_2-post" class="header-anchor">#</a> 2ï¼Œpost</h3> <p>ç”¨äºå®šä¹‰åœ¨æ•´ä¸ªæµæ°´çº¿æ‰§è¡Œç»“æœçš„æƒ…å†µï¼Œé€šå¸¸å¯é…åˆé€šçŸ¥è¿›è¡Œå¯¹é¡¹ç›®æ„å»ºçŠ¶æ€çš„å‘ŠçŸ¥ã€‚æœ‰å¦‚ä¸‹å‡ ç§çŠ¶æ€ï¼š</p> <ul><li><p><code>always</code></p> <p>æ— è®ºæµæ°´çº¿æˆ–é˜¶æ®µçš„å®ŒæˆçŠ¶æ€å¦‚ä½•ï¼Œéƒ½å…è®¸åœ¨ <code>post</code> éƒ¨åˆ†è¿è¡Œè¯¥æ­¥éª¤ã€‚</p></li> <li><p><code>changed</code></p> <p>åªæœ‰å½“å‰æµæ°´çº¿æˆ–é˜¶æ®µçš„å®ŒæˆçŠ¶æ€ä¸å®ƒä¹‹å‰çš„è¿è¡Œä¸åŒæ—¶ï¼Œæ‰å…è®¸åœ¨ <code>post</code> éƒ¨åˆ†è¿è¡Œè¯¥æ­¥éª¤ã€‚</p></li> <li><p><code>failure</code></p> <p>åªæœ‰å½“å‰æµæ°´çº¿æˆ–é˜¶æ®µçš„å®ŒæˆçŠ¶æ€ä¸º&quot;failure&quot;ï¼Œæ‰å…è®¸åœ¨ <code>post</code> éƒ¨åˆ†è¿è¡Œè¯¥æ­¥éª¤, é€šå¸¸web UIæ˜¯çº¢è‰²ã€‚</p></li> <li><p><code>success</code></p> <p>åªæœ‰å½“å‰æµæ°´çº¿æˆ–é˜¶æ®µçš„å®ŒæˆçŠ¶æ€ä¸º&quot;success&quot;ï¼Œæ‰å…è®¸åœ¨ <code>post</code> éƒ¨åˆ†è¿è¡Œè¯¥æ­¥éª¤, é€šå¸¸web UIæ˜¯è“è‰²æˆ–ç»¿è‰²ã€‚</p></li> <li><p><code>unstable</code></p> <p>åªæœ‰å½“å‰æµæ°´çº¿æˆ–é˜¶æ®µçš„å®ŒæˆçŠ¶æ€ä¸º&quot;unstable&quot;ï¼Œæ‰å…è®¸åœ¨ <code>post</code> éƒ¨åˆ†è¿è¡Œè¯¥æ­¥éª¤, é€šå¸¸ç”±äºæµ‹è¯•å¤±è´¥,ä»£ç è¿è§„ç­‰é€ æˆã€‚é€šå¸¸web UIæ˜¯é»„è‰²ã€‚</p></li> <li><p><code>aborted</code></p> <p>åªæœ‰å½“å‰æµæ°´çº¿æˆ–é˜¶æ®µçš„å®ŒæˆçŠ¶æ€ä¸º&quot;aborted&quot;ï¼Œæ‰å…è®¸åœ¨ <code>post</code> éƒ¨åˆ†è¿è¡Œè¯¥æ­¥éª¤, é€šå¸¸ç”±äºæµæ°´çº¿è¢«æ‰‹åŠ¨çš„abortedã€‚é€šå¸¸web UIæ˜¯ç°è‰²ã€‚</p></li></ul> <p>å…³äºè¿™é‡Œï¼Œå¯ä»¥æœ‰æ¯”è¾ƒå·§å¦™çš„ç”¨æ³•ï¼Œåç»­å¯èƒ½ä¹Ÿä¼šä¸“é—¨åˆ—ä¸€ç¯‡æ–‡ç« æ¥ä¹¦å†™ã€‚</p> <h3 id="_3-tools"><a href="#_3-tools" class="header-anchor">#</a> 3ï¼Œtools</h3> <p>å®šä¹‰éƒ¨ç½²æµç¨‹ä¸­å¸¸ç”¨çš„ä¸€äº›å·¥å…·ï¼Œè¿™äº›å·¥å…·åœ¨<code>ç®¡ç†Jenkins</code>---&gt;<code>Global Tool Configuration</code>ä¸­æ·»åŠ ï¼Œç„¶ååœ¨é¡¹ç›®ä¸­å¼•ç”¨ã€‚</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>pipeline <span class="token punctuation">{</span>
    agent any
    tools <span class="token punctuation">{</span>
        maven <span class="token string">'maven'</span> 
    <span class="token punctuation">}</span>
    stages <span class="token punctuation">{</span>
        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'Example'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                sh <span class="token string">'mvn --version'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="_4-parameters"><a href="#_4-parameters" class="header-anchor">#</a> 4ï¼Œparameters</h3> <p>parameters æŒ‡ä»¤æä¾›ç”¨æˆ·åœ¨è§¦å‘ Pipeline æ—¶åº”æä¾›çš„å‚æ•°åˆ—è¡¨ï¼Œä¹Ÿå°±æ˜¯åœ¨ä»¥å¾€çš„free styleé£æ ¼ä¸­æœ€å¸¸ç”¨åˆ°çš„å‚æ•°åŒ–æ„å»ºï¼Œæˆ‘ä»¬ä¸å¿…åœ¨æ¯æ¬¡æ–°å»ºé¡¹ç›®ä¹‹åï¼Œä¸€æ­¥ä¸€æ­¥åœ¨webç•Œé¢ä¸­é…ç½®éœ€è¦çš„å‚æ•°ï¼Œè€Œæ˜¯å¯ä»¥ç›´æ¥é€šè¿‡å£°æ˜å¼è¿›è¡Œå‚æ•°åŒ–é£æ ¼å®šä¹‰ï¼Œè¿™æ ·æå¤§ç®€åŒ–äº†é…ç½®å·¥ä½œã€‚</p> <p>parameters æŒ‡ä»¤æ”¯æŒä»¥ä¸‹å‡ ç§å¸¸ç”¨ç±»å‹ï¼š</p> <ul><li><p>stringï¼Œå­—ç¬¦ä¸²ç±»å‹ã€‚</p> <p>ä»¥å¾€å¸¸å¸¸é€šè¿‡è¿™ä¸ªå‚æ•°ï¼Œæ¥å®šä¹‰æ‰‹åŠ¨æ„å»ºæ—¶è¾“å…¥å°†è¦æ„å»ºçš„ä»£ç åˆ†æ”¯ï¼Œé‚£ä¹ˆè¿™é‡Œå¯ä»¥ç”¨å¦‚ä¸‹æ–¹å¼è¡¨è¾¾ï¼š</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>pipeline <span class="token punctuation">{</span>
    agent any
    parameters <span class="token punctuation">{</span>
        <span class="token function">string</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string">'branch'</span><span class="token punctuation">,</span> defaultValue<span class="token punctuation">:</span> <span class="token string">'master'</span><span class="token punctuation">,</span> description<span class="token punctuation">:</span> <span class="token string">'è¯·è¾“å…¥å°†è¦æ„å»ºçš„ä»£ç åˆ†æ”¯'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><code>æ³¨æ„ï¼š</code>è¿™ç§å£°æ˜å®šä¹‰ä¹‹åï¼Œéœ€è¦æ‰‹åŠ¨æ„å»ºä¸€æ¬¡ï¼Œç„¶åé…ç½®å°±ä¼šè‡ªåŠ¨è½ä½åˆ°åŸæ¥ç†Ÿæ‚‰çš„å‚æ•°åŒ–æ„å»ºä¸­äº†ã€‚</p></li> <li><p>choiceï¼Œé€‰é¡¹å‚æ•°ç±»å‹ã€‚</p> <p>ä»¥å¾€ç»å¸¸ä¼šé€‰ç”¨è¿™ä¸ªå‚æ•°ï¼Œç”¨äºæŒ‡å®šæ„å»ºçš„æ–¹å‘æ˜¯éƒ¨ç½²è¿˜æ˜¯å›æ»šï¼Œå¤šä¸ªå‚æ•°æœ‰ä¸¤ç§è¡¨è¾¾æ–¹å¼ã€‚</p> <p><code>å…¶ä¸€ï¼š</code></p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>pipeline <span class="token punctuation">{</span>
    agent any
    parameters <span class="token punctuation">{</span>
        <span class="token function">choice</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string">'mode'</span><span class="token punctuation">,</span> choices<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'deploy'</span><span class="token punctuation">,</span> <span class="token string">'rollback'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> description<span class="token punctuation">:</span> <span class="token string">'é€‰æ‹©æ–¹å‘ï¼'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><code>å…¶äºŒï¼š</code></p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>pipeline <span class="token punctuation">{</span>
    agent any
    parameters <span class="token punctuation">{</span>
        <span class="token function">choice</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string">'ENV_TYPE'</span><span class="token punctuation">,</span> choices<span class="token punctuation">:</span> <span class="token string">'test\n\pre\nprod'</span><span class="token punctuation">,</span> description<span class="token punctuation">:</span> <span class="token string">'è¯·é€‰æ‹©éƒ¨ç½²çš„ç¯å¢ƒ'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ul> <p>ä»¥ä¸Šä¸¤ç§å‚æ•°ï¼Œåšä¸€ä¸ªç®€å•çš„é…ç½®å®éªŒï¼Œé¦–å…ˆå‡†å¤‡å¦‚ä¸‹ä¼ªä»£ç ï¼š</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>pipeline<span class="token punctuation">{</span>
    agent any
    parameters <span class="token punctuation">{</span>
        <span class="token function">string</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string">'branch'</span><span class="token punctuation">,</span> defaultValue<span class="token punctuation">:</span> <span class="token string">'master'</span><span class="token punctuation">,</span> description<span class="token punctuation">:</span> <span class="token string">'è¯·è¾“å…¥å°†è¦æ„å»ºçš„ä»£ç åˆ†æ”¯'</span><span class="token punctuation">)</span>
        <span class="token function">choice</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string">'mode'</span><span class="token punctuation">,</span> choices<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'deploy'</span><span class="token punctuation">,</span> <span class="token string">'rollback'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> description<span class="token punctuation">:</span> <span class="token string">'é€‰æ‹©æ–¹å‘ï¼'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    stages <span class="token punctuation">{</span>
        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps<span class="token punctuation">{</span>
                script <span class="token punctuation">{</span>
                    sh <span class="token string gstring">&quot;java -version&quot;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>  
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>åˆ›å»ºä¸€ä¸ªæ–°çš„pipelineé£æ ¼çš„é¡¹ç›®ï¼Œå°†å¦‚ä¸Šä»£ç å¡«å†™è¿›å…¥ï¼Œç‚¹å‡»æ„å»ºï¼Œç„¶åå‚æ•°å°±ä¼šè½ä½åˆ°å¯¹åº”çš„ä½ç½®äº†ã€‚</p> <p><img src="http://t.eryajf.net/imgs/2021/09/fd909370e87f205f.jpg" alt="img"></p> <p>æ¥ç€ç»§ç»­ä»‹ç»è¿™é‡Œçš„å‚æ•°ã€‚</p> <ul><li><p>booleanParamï¼Œå¸ƒå°”å€¼å‚æ•°</p> <p>å°±æ˜¯å®šä¹‰ä¸€ä¸ªå¸ƒå°”ç±»å‹å‚æ•°ï¼Œç”¨æˆ·å¯ä»¥åœ¨ Jenkins UI ä¸Šé€‰æ‹©æ˜¯è¿˜æ˜¯å¦ï¼Œé€‰æ‹©æ˜¯è¡¨ç¤ºä»£ç ä¼šæ‰§è¡Œè¿™éƒ¨åˆ†ï¼Œå¦‚æœé€‰æ‹©å¦ï¼Œä¼šè·³è¿‡è¿™éƒ¨åˆ†ã€‚</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>pipeline <span class="token punctuation">{</span>
    agent any
    parameters <span class="token punctuation">{</span>
        <span class="token function">booleanParam</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string">'DEBUG_BUILD'</span><span class="token punctuation">,</span> defaultValue<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> description<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>textï¼Œæ–‡æœ¬å‚æ•°</p> <p>æ–‡æœ¬ï¼ˆtextï¼‰çš„å‚æ•°å°±æ˜¯æ”¯æŒå†™å¾ˆå¤šè¡Œçš„å­—ç¬¦ä¸²ã€‚</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>pipeline <span class="token punctuation">{</span>
    agent any
    parameters <span class="token punctuation">{</span>
        <span class="token function">text</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string">'Deploy_text'</span><span class="token punctuation">,</span> defaultValue<span class="token punctuation">:</span> <span class="token string">'One\nTwo\nThree\n'</span><span class="token punctuation">,</span> description<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>passwordï¼Œå¯†ç å‚æ•°</p> <p>å¯†ç ï¼ˆpasswordï¼‰å‚æ•°å°±æ˜¯åœ¨ Jenkins å‚æ•°åŒ–æ„å»º UI æä¾›ä¸€ä¸ªæš—æ–‡å¯†ç è¾“å…¥æ¡†ï¼Œæ‰€æœ‰éœ€è¦è„±æ•çš„ä¿¡æ¯ï¼Œéƒ½å¯ä»¥é€šè¿‡è¿™ä¸ªå‚æ•°æ¥é…ç½®ã€‚</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>Pipeline <span class="token punctuation">{</span>
    agent any
    parameters <span class="token punctuation">{</span>
        <span class="token function">password</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string">'PASSWORD'</span><span class="token punctuation">,</span> defaultValue<span class="token punctuation">:</span> <span class="token string">'SECRET'</span><span class="token punctuation">,</span> description<span class="token punctuation">:</span> <span class="token string">'A secret password'</span><span class="token punctuation">)</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li></ul> <p>å¦‚ä¸Šå‚æ•°å·²ç»åŸºæœ¬ä¸Šå¯ä»¥æ»¡è¶³æ—¥å¸¸éœ€æ±‚ï¼Œæ€è·¯å¤§æ¦‚å°±æ˜¯é€šè¿‡Jenkinsfileçš„é…ç½®ï¼Œéƒ¨ç½²ä»æ—§æ²¿ç”¨ä»¥å¾€å¸¸è§„çš„æ‰‹åŠ¨éƒ¨ç½²çš„æ–¹å¼ï¼Œè¿™ç§æ–¹å¼åœ¨é«˜æ•ˆç‡æŒç»­æ„å»ºæ–¹é¢ï¼Œä¼¼ä¹å·²ç»ä¸å¤§é€‚åˆï¼Œæ‰€ä»¥ä»¥åå¯ä»¥ä¸inputå‚æ•°é…åˆä½¿ç”¨ï¼Œè¿™é‡Œä¸å±•å¼€ï¼Œä»¥åå¯ä¸“é—¨åˆ—ä¸€ç¯‡æ–‡ç« æ¥è®²ã€‚</p> <h3 id="_5-input"><a href="#_5-input" class="header-anchor">#</a> 5ï¼Œinput</h3> <p><code>stage</code> çš„ <code>input</code> æŒ‡ä»¤å…è®¸ä½ ä½¿ç”¨ <a href="https://jenkins.io/doc/pipeline/steps/pipeline-input-step/#input-wait-for-interactive-input" target="_blank" rel="noopener noreferrer"><code>input</code> step<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>æç¤ºè¾“å…¥ã€‚ åœ¨åº”ç”¨äº† <code>options</code> åï¼Œè¿›å…¥ <code>stage</code> çš„ <code>agent</code> æˆ–è¯„ä¼° <code>when</code> æ¡ä»¶å‰ï¼Œ <code>stage</code> å°†æš‚åœã€‚ å¦‚æœ <code>input</code> è¢«æ‰¹å‡†, <code>stage</code> å°†ä¼šç»§ç»­ã€‚ ä½œä¸º <code>input</code> æäº¤çš„ä¸€éƒ¨åˆ†çš„ä»»ä½•å‚æ•°éƒ½å°†åœ¨ç¯å¢ƒä¸­ç”¨äºå…¶ä»– <code>stage</code>ã€‚</p> <p>ä¸€ä¸ªæˆç†Ÿçš„inputï¼Œå¤§æ¦‚éœ€è¦å¦‚ä¸‹å‡ ä¸ªè¦ç‚¹ï¼š</p> <ul><li><p>message</p> <ul><li>å¿…éœ€çš„ã€‚ è¿™å°†åœ¨ç”¨æˆ·æäº¤ <code>input</code> æ—¶ä½œä¸ºè¯´æ˜ä¿¡æ¯å‘ˆç°ç»™ç”¨æˆ·ã€‚</li></ul></li> <li><p>id</p> <ul><li><code>input</code> çš„å¯é€‰æ ‡è¯†ç¬¦ï¼Œ é»˜è®¤ä¸º <code>stage</code> åç§°ã€‚</li></ul></li> <li><p>ok</p> <ul><li>è‡ªå®šä¹‰ç¡®å®šæŒ‰é’®çš„æ–‡æœ¬ä¿¡æ¯ã€‚</li></ul></li> <li><p>submitter</p> <ul><li>å¯é€‰çš„ä»¥é€—å·åˆ†éš”çš„ç”¨æˆ·åˆ—è¡¨æˆ–å…è®¸æäº¤ <code>input</code> çš„å¤–éƒ¨ç»„åã€‚é»˜è®¤å…è®¸ä»»ä½•ç”¨æˆ·ã€‚</li></ul></li> <li><p>submitterParameter</p> <ul><li>ç¯å¢ƒå˜é‡çš„å¯é€‰åç§°ã€‚å¦‚æœå­˜åœ¨ï¼Œç”¨ <code>submitter</code> åç§°è®¾ç½®ã€‚</li></ul></li> <li><p>parameters</p> <ul><li>æç¤ºæäº¤è€…æä¾›çš„ä¸€ä¸ªå¯é€‰çš„å‚æ•°åˆ—è¡¨ï¼Œç»“åˆå¥½äº†ï¼Œä¼šæœ‰éå¸¸å¤šçš„å¦™ç”¨ã€‚</li></ul></li></ul> <p>è¿™é‡Œç®€å•åˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œç”¨äºä¸€ç§æ€è·¯çš„å¼•å¯¼ï¼š</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>pipeline<span class="token punctuation">{</span>
    agent any
    environment<span class="token punctuation">{</span>
    approvalMap <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token punctuation">}</span>
    stages <span class="token punctuation">{</span>
        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'pre deploy'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            steps<span class="token punctuation">{</span>
                script<span class="token punctuation">{</span>
                    approvalMap <span class="token operator">=</span> input <span class="token punctuation">(</span>
                        message<span class="token punctuation">:</span> <span class="token string">'å‡†å¤‡å‘å¸ƒåˆ°å“ªä¸ªç¯å¢ƒï¼Ÿ'</span><span class="token punctuation">,</span>
                        ok<span class="token punctuation">:</span> <span class="token string">'ç¡®å®š'</span><span class="token punctuation">,</span>
                        parameters<span class="token punctuation">:</span><span class="token punctuation">[</span>
                            <span class="token function">choice</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string">'ENV'</span><span class="token punctuation">,</span>choices<span class="token punctuation">:</span> <span class="token string">'test\npre\nprod'</span><span class="token punctuation">,</span>description<span class="token punctuation">:</span> <span class="token string">'å‘å¸ƒåˆ°ä»€ä¹ˆç¯å¢ƒï¼Ÿ'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            <span class="token function">string</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string">'myparam'</span><span class="token punctuation">,</span>defaultValue<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>description<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">)</span>
                        <span class="token punctuation">]</span><span class="token punctuation">,</span>
                        submitter<span class="token punctuation">:</span> <span class="token string">'admin'</span><span class="token punctuation">,</span>
                        submitterParameter<span class="token punctuation">:</span> <span class="token string">'APPROVER'</span>
                    <span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'deploy'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            steps<span class="token punctuation">{</span>
                echo <span class="token string gstring">&quot;æ“ä½œè€…æ˜¯ <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>approvalMap<span class="token punctuation">[</span><span class="token string">'APPROVER'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>&quot;</span>
                echo <span class="token string gstring">&quot;å‘å¸ƒåˆ°ä»€ä¹ˆç¯å¢ƒ <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>approvalMap<span class="token punctuation">[</span><span class="token string">'ENV'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>&quot;</span>
                echo <span class="token string gstring">&quot;è‡ªå®šä¹‰å‚æ•° <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>approvalMap<span class="token punctuation">[</span><span class="token string">'myparam'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>ç‚¹å‡»æ„å»ºï¼Œç¨‹åºå°†ä¼šåœ¨inputçš„æ­¥éª¤åœä½ï¼Œç­‰å¾…ç”¨æˆ·è¿›è¡Œç›¸åº”è¾“å…¥ï¼Œä»è€Œè¿›è¡Œä¸åŒæ„å»ºï¼Œå½“ç„¶ï¼Œè¿™é‡Œçš„å¤šç¯å¢ƒåªæ˜¯åšäº†ä¸€ä¸ªç®€å•çš„æ‰“å°ï¼Œå¦‚æœå†ç»“åˆä¸Šåˆ¤æ–­ï¼Œä»¥åŠä¸åŒåˆ†æ”¯æ„å»ºï¼Œå°±èƒ½å®ç°æ›´åŠ ä¸°å¯Œçš„åŠŸèƒ½ï¼Œä¸ç”¨ç€æ€¥ï¼Œå¾ˆå¿«å°±ä¼šä»‹ç»Jenkinsfileä¸­çš„åˆ¤æ–­äº†ã€‚</p> <p><code>æ³¨æ„ï¼š</code>å¼€å¤´ç¯å¢ƒå˜é‡ï¼Œå…ˆåˆ›å»ºäº†ä¸€ä¸ªç©ºçš„åç§°ï¼Œåè¾¹å†å°†å®šä¹‰çš„å‚æ•°ç»“æœèµ‹å€¼ç»™å¼€å¤´çš„å˜é‡ï¼Œè¿™æ ·ä¾¿äºåè¾¹è°ƒç”¨ï¼Œè°ƒç”¨æ—¶ç›´æ¥å¼•ç”¨è¿™ä¸ªMapç±»å‹å³å¯ã€‚å¦å¤–ï¼Œå› ä¸ºè¿™ç§èµ‹å€¼çš„æ–¹å¼å±äºGroovyè¯­è¨€çš„èµ‹å€¼æ–¹å¼ï¼Œå› æ­¤å¯¹åº”çš„èµ‹å€¼è¿‡ç¨‹éœ€è¦æ”¾åœ¨scriptå—ä¸­ã€‚</p> <h3 id="_6-when"><a href="#_6-when" class="header-anchor">#</a> 6ï¼Œwhen</h3> <p><code>when</code> æŒ‡ä»¤å…è®¸æµæ°´çº¿æ ¹æ®ç»™å®šçš„æ¡ä»¶å†³å®šæ˜¯å¦åº”è¯¥æ‰§è¡Œé˜¶æ®µã€‚ <code>when</code> æŒ‡ä»¤å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªæ¡ä»¶ã€‚ å¦‚æœ <code>when</code> æŒ‡ä»¤åŒ…å«å¤šä¸ªæ¡ä»¶, æ‰€æœ‰çš„å­æ¡ä»¶å¿…é¡»è¿”å›Trueï¼Œé˜¶æ®µæ‰èƒ½æ‰§è¡Œã€‚</p> <p>whenæŒ‡ä»¤æœ‰ä¸€äº›å†…ç½®çš„æ¡ä»¶åˆ¤æ–­å…³é”®å­—ï¼Œè¿™äº›å…³é”®å­—ç”¨å¥½äº†ï¼Œä¼šç»™ç”Ÿäº§å¸¦æ¥æå¤§çš„æ•ˆç‡æå‡ï¼Œæ¥ä¸‹æ¥å°±æ¥è®¤è¯†ä¸€ä¸‹è¿™äº›å…³é”®å­—ã€‚</p> <h4 id="_1-branch"><a href="#_1-branch" class="header-anchor">#</a> 1ï¼Œbranch</h4> <p>å¾ˆæ˜æ˜¾ï¼Œè¿™ä¸ªå‚æ•°æ˜¯é’ˆå¯¹äºé¡¹ç›®åˆ†å€¼æ¥åšåˆ¤æ–­çš„ï¼Œåœ¨é…ç½®å¤šåˆ†æ”¯æ„å»ºçš„åœºæ™¯ä¸‹ï¼Œä½¿ç”¨ä¼šæ¯”è¾ƒæ–¹ä¾¿ã€‚æ¯”å¦‚ç»“åˆä¸Šè¾¹inputçš„åœºæ™¯ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå­—ç¬¦å‚æ•°ï¼Œç”¨äºåŒºåˆ«ä»£ç å‘å¸ƒçš„åˆ†æ”¯ä¸ç¯å¢ƒï¼Œä¸åŒçš„åˆ†æ”¯éƒ¨ç½²åˆ°ä¸åŒçš„ç¯å¢ƒï¼ŒåŸæ¥çš„æ€è·¯ï¼Œå¤§æ¦‚æ˜¯ç”¨if-elseåˆ¤æ–­æ¥å®ç°ã€‚</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code><span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'deploy to test'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    steps<span class="token punctuation">{</span>
        script<span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>env<span class="token punctuation">.</span>GIT_BRANCH <span class="token operator">==</span> <span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                echo <span class="token string gstring">&quot;deploy to test env&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'deploy to prod'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    steps<span class="token punctuation">{</span>
        script<span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>env<span class="token punctuation">.</span>GIT_BRANCH <span class="token operator">==</span> <span class="token string">'master'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                echo <span class="token string gstring">&quot;deploy to prod env&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>å‰è¾¹æåˆ°è¿‡ï¼Œscriptæ˜¯Groovyé£æ ¼çš„è¯­æ³•ï¼Œå¹¶ä¸æ˜¯æœ¬æ–‡æ¨èçš„é£æ ¼ï¼Œå› æ­¤å¯ä»¥ç”¨whenæ¥ä»£æ›¿ä¸Šè¾¹çš„ä»£ç ï¼š</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code><span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'deploy to test'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    when <span class="token punctuation">{</span>
        branch <span class="token string">'test'</span>
    <span class="token punctuation">}</span>
    steps<span class="token punctuation">{</span>
        echo <span class="token string gstring">&quot;deploy to test env&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'deploy to prod'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    when <span class="token punctuation">{</span>
        branch <span class="token string">'master'</span>
    <span class="token punctuation">}</span>
    steps<span class="token punctuation">{</span>
        echo <span class="token string gstring">&quot;deploy to prod env&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><code>æ³¨æ„ï¼š</code>è¿™é‡Œçš„branchè¯­æ³•åŒ¹é…ï¼Œè¿˜æ”¯æŒé€šé…ç¬¦ç±»å‹çš„ï¼Œæ¯”å¦‚ï¼Œ<code>branch 'test.*'</code>ï¼Œè¡¨ç¤ºåŒ¹é…åˆ°ä»¥testå¼€å¤´çš„åˆ†æ”¯ã€‚</p> <p>è¿™ç§ç”¨æ³•æ›´å¤šåº”ç”¨åœ¨å¤šåˆ†æ”¯æ„å»ºåœºæ™¯ä¸­ï¼Œåè¾¹æœ‰æœºä¼šå°†ä¼šä¸“é—¨ç”¨ä¸€ç¯‡æ–‡ç« æ¥ä»‹ç»ã€‚</p> <h4 id="_2-environment"><a href="#_2-environment" class="header-anchor">#</a> 2ï¼Œenvironment</h4> <p>åŒæ ·ä¹Ÿæ˜¯ä¸€ä¸ªåˆ¤æ–­ï¼Œåªä¸è¿‡åˆ¤æ–­çš„å‚æ•°æ¥æºæ˜¯ç¯å¢ƒå˜é‡çš„å€¼ï¼Œå¦‚æœç¯å¢ƒå˜é‡çš„å€¼ä¸æˆ‘ä»¬å®šä¹‰çš„ç›¸åŒï¼Œåˆ™æ‰§è¡Œï¼š</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>when<span class="token punctuation">{</span>
    environment name<span class="token punctuation">:</span> <span class="token string">'ENV'</span><span class="token punctuation">,</span>value<span class="token punctuation">:</span> <span class="token string">'prod'</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_3-not"><a href="#_3-not" class="header-anchor">#</a> 3ï¼Œnot</h4> <p>å½“åµŒå¥—æ¡ä»¶æ˜¯é”™è¯¯æ—¶ï¼Œæ‰§è¡Œè¿™ä¸ªé˜¶æ®µï¼Œå¿…é¡»åŒ…å«ä¸€ä¸ªæ¡ä»¶ï¼Œä¾‹å¦‚:</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>when <span class="token punctuation">{</span> 
		not <span class="token punctuation">{</span> branch <span class="token string">'master'</span> <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>åˆ¤æ–­ç¯å¢ƒæ¡ä»¶æ—¶ï¼Œç”¨å¦‚ä¸‹å†™æ³•ï¼š</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>when <span class="token punctuation">{</span> 
		not <span class="token punctuation">{</span> environment name<span class="token punctuation">:</span> <span class="token string">'mode'</span><span class="token punctuation">,</span>value<span class="token punctuation">:</span> <span class="token string">'deploy'</span> <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_4-allof"><a href="#_4-allof" class="header-anchor">#</a> 4ï¼ŒallOf</h4> <p>å½“æ‰€æœ‰çš„åµŒå¥—æ¡ä»¶éƒ½æ­£ç¡®æ—¶ï¼Œæ‰æ‰§è¡Œã€‚ä¾‹å¦‚:</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>when <span class="token punctuation">{</span> 
		allOf <span class="token punctuation">{</span> 
				branch <span class="token string">'master'</span><span class="token punctuation">;</span> 
				environment name<span class="token punctuation">:</span> <span class="token string">'DEPLOY_TO'</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token string">'production'</span> 
		<span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_5-anyof"><a href="#_5-anyof" class="header-anchor">#</a> 5ï¼ŒanyOf</h4> <p>å½“è‡³å°‘æœ‰ä¸€ä¸ªåµŒå¥—æ¡ä»¶ä¸ºçœŸæ—¶ï¼Œæ‰§è¡Œè¿™ä¸ªé˜¶æ®µï¼Œå¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªæ¡ä»¶ï¼Œä¾‹å¦‚:</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>when <span class="token punctuation">{</span> 
		anyOf <span class="token punctuation">{</span> 
				branch <span class="token string">'master'</span><span class="token punctuation">;</span> 
				branch <span class="token string">'dev'</span> 
		<span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_6-beforeagent"><a href="#_6-beforeagent" class="header-anchor">#</a> 6ï¼ŒbeforeAgent</h4> <p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œç¨‹åºéƒ½æ˜¯è‡ªä¸Šè€Œä¸‹æ‰§è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯åœ¨agentä¹‹åæ‰ä¼šæ‰§è¡Œwhenï¼Œä½†æ˜¯æŸäº›åœºæ™¯ä¸­ï¼Œå¯èƒ½æˆ‘ä»¬éœ€è¦å…ˆåšä¸€ä¸‹åˆ¤æ–­ï¼Œç„¶åå†è¿›å…¥åˆ°agentå­—æ®µä¸­çš„ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™ï¼Œå°±éœ€è¦ç”¨åˆ°beforeAgentã€‚</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>pipeline <span class="token punctuation">{</span>
    agent none
    stages <span class="token punctuation">{</span>
        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'Example Build'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                echo <span class="token string">'Hello World'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'Example Deploy'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            agent <span class="token punctuation">{</span>
                label <span class="token string gstring">&quot;some-label&quot;</span>
            <span class="token punctuation">}</span>
            when <span class="token punctuation">{</span>
                beforeAgent <span class="token boolean">true</span>
                branch <span class="token string">'production'</span>
            <span class="token punctuation">}</span>
            steps <span class="token punctuation">{</span>
                echo <span class="token string">'Deploying'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h4 id="_7-expression"><a href="#_7-expression" class="header-anchor">#</a> 7ï¼Œexpression</h4> <p><strong><code>expression</code></strong> ï¼šå½“æŒ‡å®šçš„Groovyè¡¨è¾¾å¼æ±‚å€¼ä¸ºtrueæ—¶æ‰§è¡Œé˜¶æ®µã€‚</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>when <span class="token punctuation">{</span> 
	expression <span class="token punctuation">{</span> <span class="token keyword">return</span> params<span class="token punctuation">.</span>DEBUG_BUILD <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>æ³¨æ„ï¼Œä»è¡¨è¾¾å¼è¿”å›å­—ç¬¦ä¸²æ—¶ï¼Œå¿…é¡»å°†å®ƒä»¬è½¬æ¢ä¸ºå¸ƒå°”å€¼æˆ–è¿”å›<code>null</code>è¡¨ç¤ºä¸º<code>false</code>ã€‚ ç®€å•åœ°è¿”å›<code>0</code>æˆ–<code>false</code>ä»å°†è¯„ä¼°ä¸º<code>true</code>ã€‚</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>when <span class="token punctuation">{</span>
	expression <span class="token punctuation">{</span> BRANCH_NAME <span class="token operator">==~</span> <span class="token string regex">/(production|staging)/</span> <span class="token punctuation">}</span>
	anyOf <span class="token punctuation">{</span>
		environment name<span class="token punctuation">:</span> <span class="token string">'DEPLOY_TO'</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token string">'production'</span>
		environment name<span class="token punctuation">:</span> <span class="token string">'DEPLOY_TO'</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token string">'staging'</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="_8-changelog"><a href="#_8-changelog" class="header-anchor">#</a> 8ï¼Œchangelog</h4> <p>å¦‚æœæ„å»ºçš„SCMæ›´æ–°æ—¥å¿—åŒ…å«ç»™å®šçš„æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ï¼Œåˆ™æ‰§è¡Œè¯¥é˜¶æ®µ ä¾‹å¦‚:</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>when <span class="token punctuation">{</span> 
	changelog <span class="token string">'.*^\\[DEPENDENCY\\] .+$'</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_9-changeset"><a href="#_9-changeset" class="header-anchor">#</a> 9ï¼Œchangeset</h4> <p>å¦‚æœæ„å»ºçš„SCMå˜æ›´é›†åŒ…å«ä¸ç»™å®šå­—ç¬¦ä¸²æˆ–globåŒ¹é…çš„ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶ï¼Œåˆ™æ‰§è¡Œè¯¥é˜¶æ®µã€‚ ä¾‹å¦‚:</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>when <span class="token punctuation">{</span> 
	changeset <span class="token string gstring">&quot;**/*.js&quot;</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œè·¯å¾„åŒ¹é…ä¸åŒºåˆ†å¤§å°å†™ï¼Œå¯ä»¥ä½¿ç”¨caseSensitiveå‚æ•°å…³é—­, ä¾‹å¦‚:</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>when <span class="token punctuation">{</span> 
	changeset glob<span class="token punctuation">:</span> <span class="token string gstring">&quot;ReadMe.*&quot;</span><span class="token punctuation">,</span> caseSensitive<span class="token punctuation">:</span> <span class="token boolean">true</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_10-equals"><a href="#_10-equals" class="header-anchor">#</a> 10ï¼Œequals</h4> <p>å½“æœŸæœ›å€¼ç­‰äºå®é™…å€¼æ—¶æ‰§è¡Œé˜¶æ®µï¼Œ ä¾‹å¦‚:</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>when <span class="token punctuation">{</span> 
	equals expected<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> actual<span class="token punctuation">:</span> currentBuild<span class="token punctuation">.</span>number 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_11-tag"><a href="#_11-tag" class="header-anchor">#</a> 11ï¼Œtag</h4> <p>å¦‚æœ<code>TAG_NAME</code>å˜é‡ä¸ç»™å®šæ¨¡å¼åŒ¹é…ï¼Œåˆ™æ‰§è¡Œè¯¥é˜¶æ®µã€‚ä¾‹å¦‚:</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>when <span class="token punctuation">{</span> 
	tag <span class="token string gstring">&quot;release-*&quot;</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>å¦‚æœæä¾›äº†ç©ºæ¨¡å¼ï¼Œåˆ™å¦‚æœ<code>TAG_NAME</code>å˜é‡å­˜åœ¨ï¼Œåˆ™å°†æ‰§è¡Œè¯¥é˜¶æ®µï¼ˆä¸buildingTagï¼ˆï¼‰ç›¸åŒï¼‰ã€‚</p> <p>å¯ä»¥åœ¨å±æ€§ä¹‹åæ·»åŠ å¯é€‰å‚æ•°æ¯”è¾ƒå™¨ï¼Œä»¥æŒ‡å®šå¦‚ä½•è¯„ä¼°åŒ¹é…çš„ä»»ä½•æ¨¡å¼ï¼š<code>EQUALS</code>ç”¨äºç®€å•å­—ç¬¦ä¸²æ¯”è¾ƒï¼ˆé»˜è®¤å€¼ï¼‰ï¼Œ<code>GLOB</code>ç”¨äºANTæ ·å¼è·¯å¾„globï¼ˆä¸ä¾‹å¦‚å˜æ›´é›†ç›¸åŒï¼‰æˆ–<code>REGEXP</code>ç”¨äºå¸¸è§„ è¡¨è¾¾åŒ¹é…ã€‚ ä¾‹å¦‚:</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>when <span class="token punctuation">{</span> 
	tag pattern<span class="token punctuation">:</span> <span class="token string gstring">&quot;release-\\d+&quot;</span><span class="token punctuation">,</span> comparator<span class="token punctuation">:</span> <span class="token string gstring">&quot;REGEXP&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_12-triggeredby"><a href="#_12-triggeredby" class="header-anchor">#</a> 12ï¼ŒtriggeredBy</h4> <p>åœ¨ç»™å®šçš„å‚æ•°è§¦å‘å½“å‰æ„å»ºæ—¶æ‰§è¡Œè¯¥é˜¶æ®µã€‚ä¾‹å¦‚ï¼š</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>when <span class="token punctuation">{</span> triggeredBy <span class="token string">'SCMTrigger'</span> <span class="token punctuation">}</span>

when <span class="token punctuation">{</span> triggeredBy <span class="token string">'TimerTrigger'</span> <span class="token punctuation">}</span>

when <span class="token punctuation">{</span> triggeredBy <span class="token string">'UpstreamCause'</span> <span class="token punctuation">}</span>

when <span class="token punctuation">{</span> triggeredBy cause<span class="token punctuation">:</span> <span class="token string gstring">&quot;UserIdCause&quot;</span><span class="token punctuation">,</span> detail<span class="token punctuation">:</span> <span class="token string gstring">&quot;vlinde&quot;</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_7-triggers"><a href="#_7-triggers" class="header-anchor">#</a> 7ï¼Œtriggers</h3> <p><code>triggers</code>æŒ‡ä»¤ç”¨äºå®šä¹‰æµæ°´çº¿è§¦å‘çš„ä¸€äº›æœºåˆ¶ä¸æ¡ä»¶ã€‚å¸¸è§„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„é¡¹ç›®éƒ½æ˜¯åŸºäºæ‰‹åŠ¨ç‚¹å‡»éƒ¨ç½²ï¼Œè¿™ç§ç­–ç•¥å°¤å…¶é€‚ç”¨äºçº¿ä¸Šç¯å¢ƒï¼Œä½†åœ¨æµ‹è¯•ç¯å¢ƒï¼Œä¹ƒè‡³äºé¢„å‘ç¯å¢ƒï¼Œåº”è¯¥å¯¹è‡ªåŠ¨æ„å»ºæœ‰æ›´é«˜çš„é›†æˆåº¦ï¼Œä½¿å¼€å‘è€…åªå…³æ³¨äºå¼€å‘ï¼Œè€Œä¸å¿…è¿‡å¤šçº ç»“æ„å»ºçš„è¿‡ç¨‹ã€‚</p> <p>ç›®å‰æµæ°´çº¿æ”¯æŒçš„è§¦å‘å™¨æœ‰ä¸‰ç§ï¼š<code>cron</code>, <code>pollSCM</code> å’Œ <code>upstream</code>ã€‚</p> <h4 id="_1-cron"><a href="#_1-cron" class="header-anchor">#</a> 1ï¼Œcron</h4> <p>é‡‡ç”¨ä¸Linuxç³»ç»Ÿä¸€æ ·çš„å®šæ—¶ä»»åŠ¡ç®¡ç†æ–¹æ¡ˆï¼Œå½“ç„¶ä¹ŸåŠ å…¥äº†ä¸€äº›æ›´ç®€å•çš„å‚æ•°é¡¹ï¼Œä»¥åº”å¯¹æŸäº›éœ€è¦å®šæœŸæ‰§è¡Œçš„åœºæ™¯ï¼Œå…¶å®å¦‚æœå‘æ•£ä¸€ä¸‹æ€ç»´ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥ç”¨cronè¿™ç§åŠŸèƒ½ï¼Œæ¥ä½œä¸ºæ•´ä¸ªç³»ç»Ÿçš„å®šæ—¶ä»»åŠ¡ç®¡ç†ä¸­å¿ƒï¼Œæ‰€æœ‰ä¸»æœºçš„å®šæ—¶ä»»åŠ¡éƒ½æ±‡æ€»åˆ°è¿™é‡Œæ¥ï¼Œç®¡ç†èµ·æ¥ä¹Ÿæ–¹ä¾¿å¾ˆå¤šã€‚</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>pipeline <span class="token punctuation">{</span>
    agent any
    triggers <span class="token punctuation">{</span>
        <span class="token function">cron</span><span class="token punctuation">(</span><span class="token string">'* * * * *'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    stages <span class="token punctuation">{</span>
        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'cronjob test'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                echo <span class="token string">'è¿™æ˜¯ä¸€ä¸ªå®šæœŸæ‰§è¡Œçš„ä»»åŠ¡'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>å®šæ—¶ä»»åŠ¡çš„è¯­æ³•å°±ä¸å±•å¼€è®²äº†ï¼Œåªåˆ—å‡ ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„ï¼Œè€Œä¸”æ¯”è¾ƒæœ‰ç©ºçš„ã€‚</p> <ul><li><p><code>H</code>å…³é”®å­—ï¼ŒHäº¦å³Hashï¼Œè¡¨ç¤ºå½“å‰ä½ç½®è·¨åº¦èŒƒå›´å†…éšæœºä¸€å€¼ã€‚</p> <p>å‡å¦‚æˆ‘ä»¬ä½¿ç”¨å®šæ—¶ä»»åŠ¡åŠŸèƒ½ï¼Œåƒæˆ‘ä¸Šè¾¹æåˆ°çš„ï¼Œç®¡ç†äº†å¤§é‡çš„æœºå™¨ï¼Œé‚£ä¹ˆå¦‚æœåœ¨åŒä¸€æ—¶é—´çªç„¶æ‰¹é‡çš„æœºå™¨æ‰§è¡Œä»»åŠ¡ï¼ŒåŠ¿å¿…ä¼šäº§ç”Ÿè´Ÿè½½ä¸å‡è¡¡çš„æƒ…å†µï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥è¿™æ ·å†™ï¼š<code>H 02 * * *</code>è¡¨ç¤ºå‡Œæ™¨ä¸¤ç‚¹çš„ä¸€ä¸ªå°æ—¶ä¸­ï¼Œéšæœºçš„ä¸€ä¸ªæ—¶é—´ç‚¹æ‰§è¡Œä»»åŠ¡ã€‚</p></li> <li><p>åŒæ—¶è¿˜å¯ä»¥ç”¨ä¸€äº›åˆ«åæ¥ç®€åŒ–æ“ä½œã€‚</p> <ul><li><code>@yearly</code>ï¼šæ¯å¹´æ‰§è¡Œä¸€æ¬¡</li> <li><code>@monthly</code>ï¼šæ¯æœˆæ‰§è¡Œä¸€æ¬¡</li> <li><code>@weekly</code>ï¼šæ¯å‘¨æ‰§è¡Œä¸€æ¬¡</li> <li><code>@daily</code>ï¼šæ¯å¤©æ‰§è¡Œä¸€æ¬¡</li> <li><code>@midnight</code>ï¼šä»£è¡¨åŠå¤œ12ç‚¹åˆ°å‡Œæ™¨2:59ä¹‹é—´çš„æŸä¸ªæ—¶é—´ã€‚</li> <li><code>@hourly</code>ï¼šæ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡</li></ul></li></ul> <h4 id="_2-pollscm"><a href="#_2-pollscm" class="header-anchor">#</a> 2ï¼ŒpollSCM</h4> <p>è¡¨ç¤ºå®šæœŸå¯¹ä»£ç ä»“åº“è¿›è¡Œæ£€æµ‹ï¼Œå¦‚æœæœ‰å˜åŒ–ï¼Œåˆ™è‡ªåŠ¨è§¦å‘æ„å»ºã€‚æˆ‘æ€ç´¢å†ä¸‰ï¼Œæ²¡æœ‰æƒ³åˆ°è¿™ç§ç­–ç•¥åœ¨å®é™…ç”Ÿäº§ä¸­çš„åº”ç”¨åœºæ™¯ï¼Œæ•…æ­¤ä¸åšè¿‡å¤šä»‹ç»ã€‚</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>pipeline <span class="token punctuation">{</span>
    agent any
    triggers <span class="token punctuation">{</span>
        <span class="token function">pollSCM</span><span class="token punctuation">(</span><span class="token string">'* * * * *'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    stages <span class="token punctuation">{</span>
        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'cronjob test'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                echo <span class="token string">'æ¯åˆ†é’Ÿæ£€æµ‹ä¸€æ¬¡ä»£ç ä»“åº“çš„å˜åŒ–'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="_3-upstream"><a href="#_3-upstream" class="header-anchor">#</a> 3ï¼Œupstream</h4> <p>å½“Bé¡¹ç›®çš„æ‰§è¡Œä¾èµ–Aé¡¹ç›®çš„æ‰§è¡Œç»“æœæ˜¯ï¼ŒAå°±æ˜¯Bçš„ä¸Šæ¸¸é¡¹ç›®ï¼Œåœ¨Jenkins2.22ä»¥ä¸Šçš„ç‰ˆæœ¬ä¸­ï¼Œå¯ä»¥é€šè¿‡upstreamå…³é”®å­—è¿›è¡Œè¿™ç§å…³ç³»çš„è¡¨ç¤ºã€‚</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>triggers <span class="token punctuation">{</span> 
		<span class="token comment">// job1,job2éƒ½æ˜¯ä»»åŠ¡åç§°</span>
		<span class="token function">upstream</span><span class="token punctuation">(</span>upstreamProjects<span class="token punctuation">:</span> <span class="token string">'job1,job2'</span><span class="token punctuation">,</span> threshold<span class="token punctuation">:</span> hudson<span class="token punctuation">.</span>model<span class="token punctuation">.</span>Result<span class="token punctuation">.</span>SUCCESS<span class="token punctuation">)</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><code>hudson.model.Result</code>æ˜¯ä¸€ä¸ªæšä¸¾ç”¨äºæŒ‡ç¤ºä¸Šæ¸¸é¡¹ç›®çŠ¶æ€ï¼ŒåŒ…å«ä»¥ä¸‹æŒ‡ä»¤ï¼š</p> <ul><li>ABORTEDï¼šä»»åŠ¡è¢«æ‰‹åŠ¨ç»ˆæ­¢ã€‚</li> <li>FAILUREï¼šæ„å»ºå¤±è´¥ã€‚</li> <li>SUCCESSï¼šæ„å»ºæˆåŠŸã€‚</li> <li>UNSTABLEï¼šå­˜åœ¨ä¸€äº›é”™è¯¯ï¼Œä½†ä¸è‡³äºæ„å»ºå¤±è´¥ã€‚</li> <li>NOT_BUILTï¼šå†å¤šé˜¶æ®µæ„å»ºæ—¶ï¼Œå‰é¢é˜¶æ®µçš„é—®é¢˜å¯¼è‡´åé¢é˜¶æ®µæ— æ³•æ‰§è¡Œã€‚</li></ul> <h4 id="_4-gitlabäº‹ä»¶è§¦å‘ã€‚"><a href="#_4-gitlabäº‹ä»¶è§¦å‘ã€‚" class="header-anchor">#</a> 4ï¼Œgitlabäº‹ä»¶è§¦å‘ã€‚</h4> <p>è¿™ä¸ªæ‰æ˜¯çœŸæ­£æ›´å¤šåº”ç”¨åœºæ™¯çš„ï¼Œå¤§å¤šæ—¶å€™ï¼Œæˆ‘ä»¬éƒ½é»˜è®¤å°†é¡¹ç›®é…ç½®ä¸ºï¼Œå¼€å‘è€…æäº¤æŸäº›åˆ†æ”¯ï¼Œç„¶åè‡ªåŠ¨è§¦å‘å¯¹åº”çš„æ„å»ºã€‚ä¼ ç»Ÿæ–¹å¼ä¸‹ï¼Œéœ€è¦æ¯”è¾ƒå¤æ‚çš„å‡ æ­¥é…ç½®ï¼Œä½†æ˜¯åœ¨pipelineä¸­ä¹Ÿå¯ä»¥é€šè¿‡ä»£ç å½¢å¼å¯¹è¿™ç§è§¦å‘å™¨è¿›è¡Œé…ç½®ï¼Œå®åœ¨æ˜¯ä¸€å¤§ä¾¿åˆ©ç¥å™¨ã€‚</p> <p>åˆ°è¿™å„¿ï¼ŒåŸºæœ¬ä¸Šæ¯ä¸ªé¡¹ç›®åœ¨Jenkinså½“ä¸­çš„è€¦åˆï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¶Šæ¥è¶Šå°‘äº†ï¼Œæˆ‘ä»¬è¿ç»´äººå‘˜ï¼Œåªéœ€ä¸“æ³¨ç»´æŠ¤ <code>Jenkinsfile</code>ï¼Œç„¶ååˆ›å»ºå¯¹åº”é¡¹ç›®ï¼Œåªéœ€åœ¨æµæ°´çº¿å¤„é…ç½®ä»£ç urlå³å¯ã€‚</p> <p>è¿™é‡Œå…ˆç®€å•åšä¸€ä¸‹ç¤ºä¾‹ä»‹ç»ï¼Œå¹¶ä¸å±•å¼€ï¼Œåè¾¹ä¹Ÿä¼šä¸“é—¨å†™ç¯‡æ–‡ç« æ¥ä»‹ç»è¿™ç§åº”ç”¨æ–¹å¼ï¼Œæ³¨æ„ï¼Œgitlabè§¦å‘Jenkinsçš„æ„å»ºéœ€è¦ä¾èµ–<code>Gitlabæ’ä»¶</code>ï¼Œè€Œå¹¶ä¸éœ€è¦æ’ä»¶å½“ä¸­åˆ—å‡ºæ¥çš„æ‰€è°“çš„gitlab hookã€‚</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>pipeline <span class="token punctuation">{</span>
    agent any
    triggers<span class="token punctuation">{</span>
        <span class="token function">gitlab</span><span class="token punctuation">(</span> triggerOnPush<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                triggerOnMergeRequest<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                branchFilterType<span class="token punctuation">:</span> <span class="token string">'All'</span><span class="token punctuation">,</span>
                secretToken<span class="token punctuation">:</span> <span class="token string gstring">&quot;028d848ab64f&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    stages <span class="token punctuation">{</span>
        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'build'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                echo <span class="token string">'æäº¤è§¦å‘çš„æ„å»º'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>å¯¹äºè§¦å‘å™¨æ‰€ç”¨åˆ°çš„å‚æ•°ï¼Œè¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹ï¼š</p> <ul><li><p>triggerOnPushï¼šå½“Gitlabè§¦å‘pushäº‹ä»¶æ—¶ï¼Œæ˜¯å¦æ‰§è¡Œæ„å»ºã€‚</p></li> <li><p>triggerOnMergeRequestï¼šå½“Gitlabè§¦å‘mergeRequestäº‹ä»¶æ—¶ï¼Œæ˜¯å¦æ‰§è¡Œæ„å»ºã€‚</p></li> <li><p>branchFilterTypeï¼šåªæœ‰ç¬¦åˆæ¡ä»¶çš„åˆ†æ”¯æ‰ä¼šè§¦å‘æ„å»ºï¼Œå¿…é€‰ï¼Œå¦åˆ™æ— æ³•å®ç°è§¦å‘ã€‚</p> <p>å¯é€‰å‚æ•°æœ‰ï¼š</p> <ul><li>Allï¼šæ‰€æœ‰åˆ†æ”¯ã€‚</li> <li>NameBasedFilterï¼šåŸºäºåˆ†æ”¯åè¿›è¡Œè¿‡æ»¤ï¼Œå¤šä¸ªåˆ†æ”¯åä½¿ç”¨é€—å·åˆ†éš”ã€‚
<ul><li>includeBranchesSpecï¼šåŸºäºbranchFilterTypeå€¼ï¼Œè¾“å…¥æœŸæœ›åŒ…æ‹¬çš„åˆ†æ”¯çš„è§„åˆ™ã€‚</li> <li>excludeBranchesSpecï¼šåŸºäºbranchFilterTypeå€¼ï¼Œè¾“å…¥æœŸæœ›æ’é™¤çš„åˆ†æ”¯çš„è§„åˆ™ã€‚</li></ul></li> <li>RegexBasedFilterï¼šåŸºäºæ­£åˆ™è¡¨è¾¾å¼å¯¹åˆ†æ”¯åè¿›è¡Œè¿‡æ»¤ã€‚
<ul><li>sourceBranchRegexï¼šå®šä¹‰æœŸæœ›çš„é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼é™åˆ¶çš„åˆ†æ”¯è§„åˆ™ã€‚</li></ul></li></ul> <p>æ‰€æœ‰åˆ†æ”¯è¿™ä¸ªé€‰é¡¹ä¸ç”¨è§£é‡Šäº†ï¼Œå…¶ä½™ä¸¤ä¸ªé€‰é¡¹æ€ä¹ˆç”¨ï¼Œæ‰æ˜¯æ¯”è¾ƒé‡è¦ï¼Œè€Œä¸”å¯èƒ½åœ¨å®é™…ç”Ÿäº§ä¸­ï¼Œç»å¸¸æˆ–è€…ä¸€å®šä¼šç”¨åˆ°çš„ã€‚ä½†æ˜¯ç½‘ä¸Šçš„æ–‡ç« ï¼Œä¹ƒè‡³äºJenkinsçš„å®˜æ–¹æ–‡æ¡£ï¼Œä¹Ÿéƒ½åªæ˜¯åƒä¸Šè¾¹é‚£æ ·ï¼Œæåˆ°äº†æœ‰è¿™æ ·çš„è¯­æ³•è§„åˆ™å­˜åœ¨ï¼Œå¹¶æ²¡æœ‰ä»»ä½•ä¸€ä¸ªåœ°æ–¹ç»™å‡ºç¤ºä¾‹çš„ï¼Œå½“æˆ‘å»åˆ°Gitlabæ’ä»¶çš„å®˜æ–¹åœ°å€åï¼Œå‘ç°äº†ä¸‹è¾¹ç¬¬ä¸€ç§è¯­æ³•çš„ç®€å•ç¤ºä¾‹ï¼Œä»æ—§æ²¡æœ‰æˆ‘æƒ³è¦çš„åŸºäºæ­£åˆ™é™åˆ¶çš„é‚£ç§ï¼Œäºæ˜¯ï¼Œå„ä½æ³¨æ„ï¼Œçœ‹åˆ°è¿™ä¸ªåœ°æ–¹çš„ï¼Œéƒ½æ˜¯ç¼˜åˆ†ï¼Œä¹Ÿæ˜¯ç¦æ°”ï¼Œå› ä¸ºæœéå…¨ç½‘ä¹Ÿæ²¡æœ‰çš„ç¤ºä¾‹ï¼Œé¦–æ¬¡äº®ç›¸ï¼Œå°±æ˜¯åœ¨è¿™é‡Œã€‚</p> <ul><li>å¦‚æœåªæ¥å—å›ºå®šåˆ†æ”¯çš„è§¦å‘è¯·æ±‚ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</li></ul> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>	triggers<span class="token punctuation">{</span>
        <span class="token function">gitlab</span><span class="token punctuation">(</span> triggerOnPush<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                triggerOnMergeRequest<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
								branchFilterType<span class="token punctuation">:</span> <span class="token string gstring">&quot;NameBasedFilter&quot;</span><span class="token punctuation">,</span>
                includeBranchesSpec<span class="token punctuation">:</span> <span class="token string gstring">&quot;release&quot;</span><span class="token punctuation">,</span>
                secretToken<span class="token punctuation">:</span> <span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>env<span class="token punctuation">.</span>git_token<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>å¦‚æœæƒ³é€šè¿‡æ­£åˆ™åŒ¹é…åˆ°æŸäº›åˆ†æ”¯è¿›è¡Œè§¦å‘ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</li></ul> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>	triggers<span class="token punctuation">{</span>
        <span class="token function">gitlab</span><span class="token punctuation">(</span> triggerOnPush<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                triggerOnMergeRequest<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
								branchFilterType<span class="token punctuation">:</span> <span class="token string gstring">&quot;RegexBasedFilter&quot;</span><span class="token punctuation">,</span>
                sourceBranchRegex<span class="token punctuation">:</span> <span class="token string gstring">&quot;test.*&quot;</span><span class="token punctuation">,</span>
                secretToken<span class="token punctuation">:</span> <span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>env<span class="token punctuation">.</span>git_token<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li></ul> <p><code>æ³¨æ„ï¼š</code>æ‰€æœ‰è§¦å‘å™¨åŒæ ·éƒ½éœ€è¦å…ˆæ‰‹åŠ¨æ‰§è¡Œä¸€æ¬¡ï¼Œè®©JenkinsåŠ è½½å…¶ä¸­çš„é…ç½®ï¼Œå¯¹åº”çš„æŒ‡ä»¤æ‰ä¼šç”Ÿæ•ˆã€‚</p> <h3 id="_8-parallel"><a href="#_8-parallel" class="header-anchor">#</a> 8ï¼Œparallel</h3> <p>parallelå…³é”®å­—ç”¨äºæŒ‡å®šæŸäº›é˜¶æ®µå¯ä»¥å¹¶è¡Œçš„æƒ…å†µï¼Œå½“ç„¶ï¼Œæµæ°´çº¿çš„æƒ…å†µä¸‹ï¼Œå¤§æ¦‚ç‡éƒ½æ˜¯ä¸²è¡Œçš„åœºæ™¯ï¼Œä¹Ÿæ­£ç¬¦åˆæ‰€è°“æµæ°´ç®¡é“çš„å®šä¹‰ï¼Œè¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹å¹¶è¡Œçš„ç”¨æ³•ï¼Œå¹¶ä¸å±•å¼€è¿‡å¤šè®²è§£ã€‚</p> <p>å£°æ˜å¼æµæ°´çº¿çš„é˜¶æ®µå¯ä»¥åœ¨ä»–ä»¬å†…éƒ¨å£°æ˜å¤šéš”åµŒå¥—é˜¶æ®µ, å®ƒä»¬å°†å¹¶è¡Œæ‰§è¡Œã€‚ æ³¨æ„ï¼Œä¸€ä¸ªé˜¶æ®µå¿…é¡»åªæœ‰ä¸€ä¸ª <code>steps</code> æˆ– <code>parallel</code> çš„é˜¶æ®µã€‚ åµŒå¥—é˜¶æ®µæœ¬èº«ä¸èƒ½åŒ…å«è¿›ä¸€æ­¥çš„ <code>parallel</code> é˜¶æ®µ, ä½†æ˜¯å…¶ä»–çš„é˜¶æ®µçš„è¡Œä¸ºä¸ä»»ä½•å…¶ä»– <code>stage</code> ç›¸åŒã€‚ä»»ä½•åŒ…å« <code>parallel</code> çš„é˜¶æ®µä¸èƒ½åŒ…å« <code>agent</code> æˆ– <code>tools</code> é˜¶æ®µ, å› ä¸ºä»–ä»¬æ²¡æœ‰ç›¸å…³ <code>steps</code>ã€‚</p> <p>å¦å¤–, é€šè¿‡æ·»åŠ  <code>failFast true</code> åˆ°åŒ…å« <code>parallel</code>çš„ <code>stage</code> ä¸­ï¼Œ å½“å…¶ä¸­ä¸€ä¸ªè¿›ç¨‹å¤±è´¥æ—¶ï¼Œä½ å¯ä»¥å¼ºåˆ¶æ‰€æœ‰çš„ <code>parallel</code> é˜¶æ®µéƒ½è¢«ç»ˆæ­¢ã€‚</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>pipeline <span class="token punctuation">{</span>
    agent any	
    stages <span class="token punctuation">{</span>
        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'Non-Parallel Stage'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                echo <span class="token string">'This stage will be executed first.'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'Parallel Stage'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            failFast <span class="token boolean">true</span>
            parallel <span class="token punctuation">{</span>
                <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'å¹¶è¡Œä¸€'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    steps <span class="token punctuation">{</span>
                        echo <span class="token string gstring">&quot;å¹¶è¡Œä¸€&quot;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'å¹¶è¡ŒäºŒ'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    steps <span class="token punctuation">{</span>
                        echo <span class="token string gstring">&quot;å¹¶è¡ŒäºŒ&quot;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'å¹¶è¡Œä¸‰'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    stages <span class="token punctuation">{</span>
                        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'Nested 1'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            steps <span class="token punctuation">{</span>
                                echo <span class="token string gstring">&quot;In stage Nested 1 within Branch C&quot;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>
                        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'Nested 2'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            steps <span class="token punctuation">{</span>
                                echo <span class="token string gstring">&quot;In stage Nested 2 within Branch C&quot;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><h2 id="_3-å…¶ä»–å‚æ•°"><a href="#_3-å…¶ä»–å‚æ•°" class="header-anchor">#</a> 3ï¼Œå…¶ä»–å‚æ•°</h2> <h3 id="_1-sh"><a href="#_1-sh" class="header-anchor">#</a> 1ï¼Œsh</h3> <p>å½“æˆ‘ä»¬éœ€è¦æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡æ­¤å…³é”®å­—å¼•å…¥ã€‚ç®€å•ç¤ºä¾‹å¦‚ä¸‹ï¼š</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code><span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    when <span class="token punctuation">{</span>
        branch <span class="token string">'test'</span>
    <span class="token punctuation">}</span>
    steps<span class="token punctuation">{</span>
        sh <span class="token string">'rsync -avz --progress -e '</span>ssh <span class="token operator">-</span>p <span class="token number">22</span><span class="token string">' --exclude='</span>Jenkinsfile<span class="token string">' --exclude='</span><span class="token punctuation">.</span>git<span class="token string">' --delete ${WORKSPACE}/  root@$remote_ip:$remote_dir'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'éƒ¨ç½²åˆ°çº¿ä¸Šç¯å¢ƒ'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    when <span class="token punctuation">{</span>
        branch <span class="token string">'master'</span>
    <span class="token punctuation">}</span>
    steps <span class="token punctuation">{</span>
        sh <span class="token string">'''
            echo &quot;å¼€å§‹éƒ¨ç½²&quot;
            rsync -avz --progress -e 'ssh -p 22' --exclude='Jenkinsfile' --exclude='.git' --delete ${WORKSPACE}/  root@192.168.3.61:$remote_dir
        '''</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="_2-deletedir"><a href="#_2-deletedir" class="header-anchor">#</a> 2ï¼ŒdeleteDir</h3> <p>è¡¨ç¤ºåˆ é™¤å½“å‰ç›®å½•ï¼Œé€šå¸¸ç”¨åœ¨æ„å»ºå®Œæ¯•ä¹‹åæ¸…ç©ºå·¥ä½œç©ºé—´ï¼Œæˆ–è€…ç»“åˆdirå…³é”®å­—ä½¿ç”¨ã€‚</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code><span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'delete'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    steps <span class="token punctuation">{</span>
        echo <span class="token string">'æ¸…ç†å·¥ä½œç›®å½•'</span>
        <span class="token function">deleteDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>å¦å¤–è¿˜æœ‰ä¸€ä¸ªcleanï¼ˆæ­¤æ–¹æ³•ä¾èµ–äºæ’ä»¶ <code>Workspace Cleanup</code>ï¼‰æ¸…ç†å·¥ä½œç©ºé—´æ—¶ç”¨æ³•ä¸ä¹‹ç±»ä¼¼ã€‚</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code><span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'delete'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    steps <span class="token punctuation">{</span>
        echo <span class="token string">'æ¸…ç†å·¥ä½œç›®å½•'</span>
        <span class="token function">cleanWs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>åŒºåˆ«åœ¨äºdeleteDirå¯ä»¥æŒ‡å®šç›®å½•åˆ é™¤ã€‚</p> <h3 id="_3-dirã€‚"><a href="#_3-dirã€‚" class="header-anchor">#</a> 3ï¼Œdirã€‚</h3> <p>åˆ‡æ¢ç›®å½•ï¼Œé»˜è®¤æµæ°´çº¿å·¥ä½œä¸­å·¥ä½œç©ºé—´ç›®å½•ä¸­ï¼Œä½¿ç”¨dirå¯ä»¥è¿›è¡Œç›®å½•çš„åˆ‡æ¢ã€‚</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code><span class="token function">dir</span><span class="token punctuation">(</span><span class="token string gstring">&quot;/var/logs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token function">deleteDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_4-fileexists"><a href="#_4-fileexists" class="header-anchor">#</a> 4ï¼ŒfileExists</h3> <p>åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚å¯ç”¨ç»å¯¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œç›¸å¯¹è·¯å¾„çš„æ—¶å€™ï¼Œè®°ä½æ˜¯åŸºäº <code>$WORKSPACE</code>çš„ã€‚</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>pipeline <span class="token punctuation">{</span>
    agent any
    environment <span class="token punctuation">{</span>
        git_url     <span class="token operator">=</span> <span class="token string gstring">&quot;git@192.168.3.65:jenkins-learn/hello-world.git&quot;</span>
        remote_ip   <span class="token operator">=</span> <span class="token string gstring">&quot;192.168.3.67&quot;</span>
        remote_dir  <span class="token operator">=</span> <span class="token string gstring">&quot;/opt/hello&quot;</span>
    <span class="token punctuation">}</span>
    options <span class="token punctuation">{</span>
        <span class="token function">buildDiscarder</span><span class="token punctuation">(</span><span class="token function">logRotator</span><span class="token punctuation">(</span>numToKeepStr<span class="token punctuation">:</span> <span class="token string">'10'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token function">disableConcurrentBuilds</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">timestamps</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    stages <span class="token punctuation">{</span>
        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'rsync'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                script <span class="token punctuation">{</span>
                    build_file <span class="token operator">=</span> <span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span>WORKSPACE</span>/README.md&quot;</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">fileExists</span><span class="token punctuation">(</span>build_file<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    sh <span class="token string">'''
                        rsync -avz --progress -e 'ssh -p 22' --exclude='Jenkinsfile' --exclude='.git' --delete ${WORKSPACE}/  root@$remote_ip:$remote_dir
                    '''</span>
                    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
                        <span class="token function">error</span><span class="token punctuation">(</span><span class="token string gstring">&quot;here haven't find json file&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'delete'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                echo <span class="token string">'æ¸…ç†å·¥ä½œç›®å½•'</span>
                <span class="token function">cleanWs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    post <span class="token punctuation">{</span>
        success <span class="token punctuation">{</span>
            sh <span class="token string gstring">&quot;echo æˆåŠŸäº†&quot;</span>
        <span class="token punctuation">}</span>
        failure <span class="token punctuation">{</span>
            sh <span class="token string gstring">&quot;echo å¤±è´¥äº†&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><p>è¿™ä¸ªä¾‹å­æ¯”è¾ƒé€‚åˆç”Ÿäº§å½“ä¸­çš„æƒ…å¢ƒï¼Œéƒ¨ç½²çš„æ­¥éª¤æ”¾åœ¨ç¼–è¯‘çš„åè¾¹ï¼Œå¦‚æœç¼–è¯‘ä¹‹åï¼ŒJavaé¡¹ç›®çš„waråŒ…æ²¡æœ‰ç”Ÿæˆï¼Œé‚£ä¹ˆæˆ‘ä»¬è·³å‡ºæ„å»ºï¼Œå¦‚æœç”Ÿæˆäº†ï¼Œåˆ™æ‰§è¡Œæ„å»ºçš„æ­¥éª¤ã€‚</p> <h3 id="_5-error"><a href="#_5-error" class="header-anchor">#</a> 5ï¼Œerror</h3> <p>ä¸»åŠ¨æŠ¥é”™ï¼Œç»ˆæ­¢å½“å‰æµæ°´çº¿ã€‚</p> <p>ä¸Šè¾¹å·²ç»å¼•ç”¨åˆ°äº†ï¼Œé€šå¸¸åœ¨å¸ƒå°”å‚æ•°ä¹‹åä¼šé€‰ç”¨ã€‚</p> <h3 id="_6-timeout"><a href="#_6-timeout" class="header-anchor">#</a> 6ï¼Œtimeout</h3> <p>ä»£ç å—è¶…æ—¶æ—¶é—´ã€‚é€šå¸¸è¿™åœ¨æ‰§è¡Œä¸€äº›ç¼–è¯‘æ­¥éª¤å¦‚é‡ä¸å¯çŸ¥æƒ…å†µå¯¼è‡´ç¼–è¯‘å¤±è´¥è€Œåˆä¸é€€å‡ºçš„æƒ…å†µã€‚</p> <p>timeoutæ”¯æŒå¦‚ä¸‹å‚æ•°ï¼š</p> <ul><li>timeï¼šæ•´å‹ï¼Œè¶…æ—¶æ—¶é—´ã€‚</li> <li>unitï¼šæ—¶é—´å•ä½ï¼Œæ”¯æŒçš„å€¼æœ‰NANOSECONDS,MICROSECONDS,MILLISECONDS,SECONDS,MINUTES(é»˜è®¤),HOURS,DAYS.</li> <li>activityï¼šå¸ƒå°”ç±»å‹ï¼Œå¦‚æœä¸ºtrueï¼Œåˆ™åªæœ‰å½“æ—¥å¿—æ²¡æœ‰æ´»åŠ¨ä¹‹åï¼Œæ‰çœŸæ­£ç®—è¶…æ—¶ã€‚</li></ul> <p>ç”¨æ³•ï¼Œç›´æ¥åœ¨å°†è¦æ‰§è¡Œçš„é˜¶æ®µä¹‹å¤–ï¼Œç”¨å…³é”®å­—åŒ…è£¹å³å¯ï¼š</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code><span class="token function">timeout</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		steps<span class="token punctuation">{</span>
        sh <span class="token string">'rsync -avz --progress -e '</span>ssh <span class="token operator">-</span>p <span class="token number">22</span><span class="token string">' --exclude='</span>Jenkinsfile<span class="token string">' --exclude='</span><span class="token punctuation">.</span>git<span class="token string">' --delete ${WORKSPACE}/  root@$remote_ip:$remote_dir'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_7-waitutil"><a href="#_7-waitutil" class="header-anchor">#</a> 7ï¼ŒwaitUtil</h3> <p>ç­‰å¾…æ¡ä»¶æ»¡è¶³ï¼Œä¸æ–­é‡å¤ä»£ç å—ä¸­çš„å†…å®¹ï¼Œç›´åˆ°æ¡ä»¶ä¸ºtrueã€‚è¿™ä¸ªåŠŸèƒ½çš„åº”ç”¨åœºæ™¯æˆ‘å€’æ˜¯æƒ³åˆ°äº†ä¸€ä¸ªï¼Œå¾ˆè´´åˆ‡ï¼Œæœ‰ä¸€äº›æœåŠ¡åœ¨ç”Ÿäº§ç¯å¢ƒè·‘ç€ï¼Œå¹¶ä¸èƒ½ç›´æ¥å…³é—­å‘å¸ƒï¼Œè€Œå¾€å¾€åŠ å…¥ä¸€ä¸ªä¼˜é›…åœæœºçš„åŠŸèƒ½ï¼Œå› æ­¤è°ƒç”¨åœæœºæ¥å£ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥åšä¸€ä¸ªç­‰å¾…ï¼Œç­‰å¾…æœåŠ¡ç«¯å£å½»åº•å…³é—­ä¹‹åï¼Œå†è¿›è¡Œéƒ¨ç½²ï¼Œå½“ç„¶ï¼Œæœ€å¥½å†é…åˆä¸€ä¸‹timeoutï¼Œä»¥é¿å…æ­»å¾ªç¯ã€‚</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code><span class="token function">timeout</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    waitUntil<span class="token punctuation">{</span>
        script<span class="token punctuation">{</span>
            <span class="token keyword">def</span> r <span class="token operator">=</span> sh script<span class="token punctuation">:</span> <span class="token string">'curl http://exmaple'</span><span class="token punctuation">,</span>returnStatus<span class="token punctuation">:</span> <span class="token boolean">true</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span> r <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_8-retry"><a href="#_8-retry" class="header-anchor">#</a> 8ï¼Œretry</h3> <p>é‡å¤æ‰§è¡ŒæŸä¸ªå—ï¼Œå¦‚æœæŸæ¬¡æ‰§è¡Œä¸­æœ‰å¼‚å¸¸ï¼Œåˆ™è·³å‡ºå½“æ¬¡ï¼Œè€Œä¸ä¼šå½±å“æ•´ä½“ã€‚æ³¨æ„ï¼Œåœ¨æ‰§è¡Œretryè¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·æ— æ³•æ‰‹åŠ¨ç»ˆæ­¢æµæ°´çº¿ã€‚</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>steps <span class="token punctuation">{</span>
  <span class="token function">retry</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    script<span class="token punctuation">{</span>
        sh script<span class="token punctuation">:</span> <span class="token string">'curl http://exmaple'</span><span class="token punctuation">,</span>returnStatus<span class="token punctuation">:</span> <span class="token boolean">true</span>        
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><code>æ³¨æ„ï¼š</code>ä½¿ç”¨retryå°†æ‰§è¡Œçš„å†…å®¹åŒ…ä½ã€‚</p> <h3 id="_9-sleep"><a href="#_9-sleep" class="header-anchor">#</a> 9ï¼Œsleep</h3> <p>è®©pipelineç¡çœ ä¸€æ®µæ—¶é—´ã€‚</p> <p>æ”¯æŒå‚æ•°å¦‚ä¸‹ï¼š</p> <ul><li>timeï¼šæ•´å‹ï¼Œä¼‘çœ æ—¶é—´ã€‚</li> <li>unitï¼šæ—¶é—´å•ä½ï¼Œæ”¯æŒçš„å€¼æœ‰NANOSECONDS,MICROSECONDS,MILLISECONDS,SECONDS(é»˜è®¤),MINUTES,HOURS,DAYS.</li></ul> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">120</span><span class="token punctuation">)</span> <span class="token comment">//ä¼‘çœ 120ç§’</span>
<span class="token function">sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">:</span> <span class="token string">'2'</span><span class="token punctuation">,</span>unit<span class="token punctuation">:</span> <span class="token string gstring">&quot;MINUTES&quot;</span><span class="token punctuation">)</span> <span class="token comment">//ä¼‘çœ 2åˆ†é’Ÿ</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_10-try-catch"><a href="#_10-try-catch" class="header-anchor">#</a> 10ï¼Œtry&amp;catch</h3> <p>å°½ç®¡æˆ‘éå¸¸æ¨å´‡æ—¥å¸¸æ„å»ºé‡‡ç”¨å£°æ˜å¼çš„å³å¯ï¼Œä½†æ˜¯æœ‰ä¸€äº›è„šæœ¬å¼ä¸­æ¯”è¾ƒä¸é”™çš„å‚æ•°ï¼Œä¹Ÿæ˜¯å€¼å¾—å­¦ä¹ ï¼Œè€Œä¸”å€¼å¾—è¿ç”¨çš„ã€‚è¿™ä¸ªtryä¸catchå°±æ˜¯ç±»ä¼¼çš„ä¸€ç§ã€‚</p> <p>æ—¥å¸¸æµæ°´çº¿æ„å»ºä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›æ•´æ¡çº¿æ¯ä¸€é˜¶æ®µéƒ½æ˜¯æ­£å¸¸çš„ï¼Œä¸€æ—¦æœ‰å¼‚å¸¸çš„æƒ…å†µï¼Œå°±åº”è¯¥é€€å‡ºæ„å»ºã€‚æ¯”å¦‚æˆ‘ä»¬ä¸åº”è¯¥åœ¨ç¼–è¯‘ä»£ç å¤±è´¥çš„æƒ…å†µä¸‹ï¼Œè¿˜å»é‡å¯æœåŠ¡ï¼Œéƒ¨ç½²æœåŠ¡ï¼Œè¿™æ ·æå¯èƒ½ä¼šé€ æˆä¸€äº›ä¸å¯çŸ¥çš„é—®é¢˜ï¼Œä¸¥é‡çš„è¿˜å¯èƒ½å› ä¸ºæ„å»ºå¼•å‘æœåŠ¡é—®é¢˜ã€‚</p> <p>ç®€å•è¯´æ˜å°±æ˜¯ï¼Œæµæ°´çº¿ä¼šé¡ºè¡Œæ‰§è¡Œtryå…³é”®å­—å—å†…çš„è¯­å¥ï¼Œå¦‚æœæ‰€æœ‰è¯­å¥æ‰§è¡Œéƒ½æ­£å¸¸ï¼Œé‚£ä¹ˆç¨‹åºæ­£å¸¸é€€å‡ºï¼Œå¦‚æœæœ‰å¼‚å¸¸ï¼Œåˆ™catchéƒ¨åˆ†å°†ä¼šæ•æ‰é”™è¯¯ï¼Œè¿›è¡Œæ‰“å°ï¼Œå¹¶é€€å‡ºæ•´ä¸ªæµæ°´çº¿ï¼Œè¿™ä¸€ç‚¹éå¸¸å…³é”®ï¼ŒæŸä¸ªé˜¶æ®µæœ‰å¼‚å¸¸ï¼Œæ•´ä¸ªæ„å»ºç»“æŸï¼Œè¿™ä¸€ç‰¹æ€§ï¼Œå€¼å¾—æ¨å¹¿åˆ°æ‰€æœ‰çš„æµæ°´çº¿å½“ä¸­åº”ç”¨èµ·æ¥ã€‚</p> <p>ç®€å•ç¤ºä¾‹ï¼š</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>pipeline<span class="token punctuation">{</span>
    agent any
    stages<span class="token punctuation">{</span>
        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'Example1'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                script <span class="token punctuation">{</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        echo <span class="token string">'aaa'</span>
                        eccho <span class="token string">'bbb'</span>
                        echo <span class="token string">'ccc'</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        echo <span class="token string">'err'</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>       
        <span class="token punctuation">}</span>
        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'Example2'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                script <span class="token punctuation">{</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        echo <span class="token string">'aaa'</span>
                        echo <span class="token string">'ccc'</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        echo <span class="token string">'err'</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>       
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    post<span class="token punctuation">{</span>
        always<span class="token punctuation">{</span>
            echo <span class="token string gstring">&quot;========always========&quot;</span>
        <span class="token punctuation">}</span>
        success<span class="token punctuation">{</span>
            echo <span class="token string gstring">&quot;========pipeline executed successfully ========&quot;</span>
        <span class="token punctuation">}</span>
        failure<span class="token punctuation">{</span>
            echo <span class="token string gstring">&quot;========pipeline execution failed========&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><p>å°†ä»£ç æ”¾åˆ°pipelineå½“ä¸­ï¼Œæ‰§è¡Œä»¥ä¸‹ï¼Œå¯ä»¥çœ‹ä¸‹æ„å»ºæ—¥å¿—ï¼š</p> <p><img src="http://t.eryajf.net/imgs/2021/09/5622caefe254f02c.jpg" alt="img"></p> <p>å¯ä»¥çœ‹åˆ°ï¼Œå› ä¸ºé˜¶æ®µ1ä¸­æœ‰å¼‚å¸¸ï¼Œå¯¼è‡´ç¨‹åºé€€å‡ºï¼Œé˜¶æ®µ2ä¹Ÿæ²¡æœ‰æ‰§è¡Œï¼Œå¹¶ä¸”åœ¨æœ€åæŠ›å‡ºäº†å¼‚å¸¸çš„å†…å®¹ã€‚</p> <h3 id="_11-docker"><a href="#_11-docker" class="header-anchor">#</a> 11ï¼Œdocker</h3> <p>åœ¨æµæ°´çº¿ä¸­ä½¿ç”¨dockerï¼Œèƒ½å¤Ÿæ–¹ä¾¿æˆ‘ä»¬å¯¹ä¸€äº›ç¯å¢ƒè¿›è¡Œéš”ç¦»ï¼Œä»¥åŠä¸€äº›ä¼˜ç§€è¯­æ³•çš„åº”ç”¨ä½¿å¾—æ„å»ºæ›´åŠ ä¼˜é›…ã€‚</p> <p>ä¸Šè¾¹agentè°ƒç”¨dockerå·²ç»ä»‹ç»äº†ï¼Œè¿™é‡Œç€é‡å†è¯´æ˜ä¸€ä¸‹æ‰“é•œåƒçš„æ“ä½œã€‚</p> <h4 id="_1-æ„å»ºå®¹å™¨"><a href="#_1-æ„å»ºå®¹å™¨" class="header-anchor">#</a> 1ï¼Œæ„å»ºå®¹å™¨</h4> <p>ä¸ºäº†æ„å»º Docker é•œåƒ,<a href="https://plugins.jenkins.io/docker-workflow" target="_blank" rel="noopener noreferrer">Docker æµæ°´çº¿<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> æ’ä»¶ä¹Ÿæä¾›äº†ä¸€ä¸ª <code>build()</code> æ–¹æ³•ç”¨äºåœ¨æµæ°´çº¿è¿è¡ŒæœŸé—´ä»å­˜å‚¨åº“çš„<code>Dockerfile</code> ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒã€‚</p> <p>ä½¿ç”¨è¯­æ³• <code>docker.build(&quot;my-image-name&quot;)</code> çš„ä¸»è¦å¥½å¤„æ˜¯ï¼Œ è„šæœ¬åŒ–çš„æµæ°´çº¿èƒ½å¤Ÿä½¿ç”¨åç»­ Dockeræµæ°´çº¿è°ƒç”¨çš„è¿”å›å€¼, æ¯”å¦‚:</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>node <span class="token punctuation">{</span>
    checkout scm
    <span class="token keyword">def</span> customImage <span class="token operator">=</span> docker<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token string gstring">&quot;my-image:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>env<span class="token punctuation">.</span>BUILD_ID<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">)</span>
    customImage<span class="token punctuation">.</span>inside <span class="token punctuation">{</span>
        sh <span class="token string">'make test'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>è¯¥è¿”å›å€¼ä¹Ÿå¯ä»¥ç”¨äºé€šè¿‡ <code>push()</code> æ–¹æ³•å°†Docker é•œåƒå‘å¸ƒåˆ° <a href="https://hub.docker.com/" target="_blank" rel="noopener noreferrer">Docker Hub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, æˆ– <a href="https://www.jenkins.io/zh/doc/book/pipeline/docker/#custom-registry" target="_blank" rel="noopener noreferrer">custom Registry<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>,æ¯”å¦‚:</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>node <span class="token punctuation">{</span>
    checkout scm
    <span class="token keyword">def</span> customImage <span class="token operator">=</span> docker<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token string gstring">&quot;my-image:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>env<span class="token punctuation">.</span>BUILD_ID<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">)</span>
    customImage<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>é•œåƒ &quot;tags&quot;çš„ä¸€ä¸ªå¸¸è§ç”¨æ³•æ˜¯ ä¸ºæœ€è¿‘çš„, éªŒè¯è¿‡çš„, Dockeré•œåƒçš„ç‰ˆæœ¬ï¼ŒæŒ‡å®š <code>latest</code> æ ‡ç­¾ã€‚ <code>push()</code> æ–¹æ³•æ¥å—å¯é€‰çš„ <code>tag</code> å‚æ•°, å…è®¸æµæ°´çº¿ä½¿ç”¨ä¸åŒçš„æ ‡ç­¾ push <code>customImage</code> , æ¯”å¦‚:</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>node <span class="token punctuation">{</span>
    checkout scm
    <span class="token keyword">def</span> customImage <span class="token operator">=</span> docker<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token string gstring">&quot;my-image:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>env<span class="token punctuation">.</span>BUILD_ID<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">)</span>
    customImage<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    customImage<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'latest'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œ <code>build()</code> æ–¹æ³•åœ¨å½“å‰ç›®å½•æ„å»ºä¸€ä¸ª <code>Dockerfile</code>ã€‚æä¾›ä¸€ä¸ªåŒ…å« <code>Dockerfile</code>æ–‡ä»¶çš„ç›®å½•è·¯å¾„ä½œä¸º<code>build()</code> æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•° å°±å¯ä»¥è¦†ç›–è¯¥æ–¹æ³•, æ¯”å¦‚:</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>node <span class="token punctuation">{</span>
    checkout scm
    <span class="token keyword">def</span> testImage <span class="token operator">=</span> docker<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token string gstring">&quot;test-image&quot;</span><span class="token punctuation">,</span> <span class="token string gstring">&quot;./dockerfiles/test&quot;</span><span class="token punctuation">)</span> 

    testImage<span class="token punctuation">.</span>inside <span class="token punctuation">{</span>
        sh <span class="token string">'make test'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>ä»åœ¨ <code>./dockerfiles/test/Dockerfile</code>ä¸­å‘ç°çš„Dockerfileä¸­æ„å»º<code>test-image</code>ã€‚</p> <p>é€šè¿‡æ·»åŠ å…¶ä»–å‚æ•°åˆ° <code>build()</code> æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ä¸­ï¼Œä¼ é€’å®ƒä»¬åˆ° <a href="https://docs.docker.com/engine/reference/commandline/build/" target="_blank" rel="noopener noreferrer">docker build<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€‚ å½“ä½¿ç”¨è¿™ç§æ–¹æ³•ä¼ é€’å‚æ•°æ—¶, è¯¥å­—ç¬¦ä¸²çš„æœ€åä¸€ä¸ªå€¼å¿…é¡»æ˜¯Dockeræ–‡ä»¶çš„è·¯å¾„ã€‚</p> <p>è¯¥ç¤ºä¾‹é€šè¿‡ä¼ é€’ <code>-f</code>æ ‡å¿—è¦†ç›–äº†é»˜è®¤çš„ <code>Dockerfile</code> :</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>node <span class="token punctuation">{</span>
    checkout scm
    <span class="token keyword">def</span> dockerfile <span class="token operator">=</span> <span class="token string">'Dockerfile.test'</span>
    <span class="token keyword">def</span> customImage <span class="token operator">=</span> docker<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token string gstring">&quot;my-image:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>env<span class="token punctuation">.</span>BUILD_ID<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">,</span> <span class="token string gstring">&quot;-f <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>dockerfile<span class="token punctuation">}</span></span> ./dockerfiles&quot;</span><span class="token punctuation">)</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>ä»åœ¨<code>./dockerfiles/Dockerfile.test</code>å‘ç°çš„Dockerfileæ„å»º <code>my-image:${env.BUILD_ID}</code>ã€‚</p> <h4 id="_2-ä½¿ç”¨è‡ªå®šä¹‰æ³¨å†Œè¡¨"><a href="#_2-ä½¿ç”¨è‡ªå®šä¹‰æ³¨å†Œè¡¨" class="header-anchor">#</a> 2ï¼Œä½¿ç”¨è‡ªå®šä¹‰æ³¨å†Œè¡¨</h4> <p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ <a href="https://plugins.jenkins.io/docker-workflow" target="_blank" rel="noopener noreferrer">Docker æµæ°´çº¿<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> é›†æˆäº† <a href="https://hub.docker.com/" target="_blank" rel="noopener noreferrer">Docker Hub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>é»˜è®¤çš„ Dockeræ³¨å†Œè¡¨ã€‚ .</p> <p>ä¸ºäº†ä½¿ç”¨è‡ªå®šä¹‰Docker æ³¨å†Œå§, è„šæœ¬åŒ–æµæ°´çº¿çš„ç”¨æˆ·èƒ½å¤Ÿä½¿ç”¨ <code>withRegistry()</code> æ–¹æ³•å®Œæˆæ­¥éª¤ï¼Œä¼ å…¥è‡ªå®šä¹‰æ³¨å†Œè¡¨çš„URL, æ¯”å¦‚:</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>node <span class="token punctuation">{</span>
    checkout scm

    docker<span class="token punctuation">.</span><span class="token function">withRegistry</span><span class="token punctuation">(</span><span class="token string">'https://registry.example.com'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        docker<span class="token punctuation">.</span><span class="token function">image</span><span class="token punctuation">(</span><span class="token string">'my-custom-image'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>inside <span class="token punctuation">{</span>
            sh <span class="token string">'make test'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>å¯¹äºéœ€è¦èº«ä»½éªŒè¯çš„Docker æ³¨å†Œè¡¨, ä»Jenkins ä¸»é¡µæ·»åŠ ä¸€ä¸ª &quot;Username/Password&quot; è¯ä¹¦é¡¹ï¼Œ å¹¶ä½¿ç”¨è¯ä¹¦ID ä½œä¸º <code>withRegistry()</code>çš„ç¬¬äºŒä¸ªå‚æ•°:</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>node <span class="token punctuation">{</span>
    checkout scm

    docker<span class="token punctuation">.</span><span class="token function">withRegistry</span><span class="token punctuation">(</span><span class="token string">'https://registry.example.com'</span><span class="token punctuation">,</span> <span class="token string">'credentials-id'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">def</span> customImage <span class="token operator">=</span> docker<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token string gstring">&quot;my-image:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>env<span class="token punctuation">.</span>BUILD_ID<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">)</span>

        <span class="token comment">/* Push the container to the custom Registry */</span>
        customImage<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="_3-è¿è¡Œ-sidecar-å®¹å™¨"><a href="#_3-è¿è¡Œ-sidecar-å®¹å™¨" class="header-anchor">#</a> 3ï¼Œè¿è¡Œ &quot;sidecar&quot; å®¹å™¨</h4> <p>åœ¨æµæ°´çº¿ä¸­ä½¿ç”¨Dockerå¯èƒ½æ˜¯è¿è¡Œæ„å»ºæˆ–ä¸€ç»„æµ‹è¯•çš„æ‰€ä¾èµ–çš„æœåŠ¡çš„æœ‰æ•ˆæ–¹æ³•ã€‚ç±»ä¼¼äº <a href="https://docs.microsoft.com/en-us/azure/architecture/patterns/sidecar" target="_blank" rel="noopener noreferrer">sidecar æ¨¡å¼<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, Docker æµæ°´çº¿å¯ä»¥&quot;åœ¨åå°&quot;è¿è¡Œä¸€ä¸ªå®¹å™¨ , è€Œåœ¨å¦å¤–ä¸€ä¸ªå®¹å™¨ä¸­å·¥ä½œã€‚ åˆ©ç”¨è¿™ç§sidecar æ–¹å¼, æµæ°´çº¿å¯ä»¥ä¸ºæ¯ä¸ªæµæ°´çº¿è¿è¡Œ æä¾›ä¸€ä¸ª&quot;å¹²å‡€çš„&quot; å®¹å™¨ã€‚</p> <p>è€ƒè™‘ä¸€ä¸ªå‡è®¾çš„é›†æˆæµ‹è¯•å¥—ä»¶ï¼Œå®ƒä¾èµ–äºæœ¬åœ° MySQL æ•°æ®åº“æ¥è¿è¡Œã€‚ä½¿ç”¨ <code>withRun</code> æ–¹æ³•, åœ¨ <a href="https://plugins.jenkins.io/docker-workflow" target="_blank" rel="noopener noreferrer">Docker Pipeline<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> æ’ä»¶ä¸­å®ç°å¯¹è„šæœ¬åŒ–æµæ°´çº¿çš„æ”¯æŒ, <code>Jenkinsfile</code> æ–‡ä»¶å¯ä»¥è¿è¡Œ MySQLä½œä¸ºsidecar :</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>node <span class="token punctuation">{</span>
    checkout scm
    <span class="token comment">/*
     * In order to communicate with the MySQL server, this Pipeline explicitly
     * maps the port (`3306`) to a known port on the host machine.
     */</span>
    docker<span class="token punctuation">.</span><span class="token function">image</span><span class="token punctuation">(</span><span class="token string">'mysql:5'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withRun</span><span class="token punctuation">(</span><span class="token string">'-e &quot;MYSQL_ROOT_PASSWORD=my-secret-pw&quot; -p 3306:3306'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> c <span class="token operator">-&gt;</span>
        <span class="token comment">/* Wait until mysql service is up */</span>
        sh <span class="token string">'while ! mysqladmin ping -h0.0.0.0 --silent; do sleep 1; done'</span>
        <span class="token comment">/* Run some tests which require MySQL */</span>
        sh <span class="token string">'make check'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>è¯¥ç¤ºä¾‹å¯ä»¥æ›´è¿›ä¸€æ­¥, åŒæ—¶ä½¿ç”¨ä¸¤ä¸ªå®¹å™¨ã€‚ ä¸€ä¸ª &quot;sidecar&quot; è¿è¡Œ MySQL, å¦ä¸€ä¸ªæä¾›<a href="https://www.jenkins.io/zh/doc/book/pipeline/docker/#execution-environment" target="_blank" rel="noopener noreferrer">æ‰§è¡Œç¯å¢ƒ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, é€šè¿‡ä½¿ç”¨Docker <a href="https://docs.docker.com/engine/userguide/networking/default_network/dockerlinks/" target="_blank" rel="noopener noreferrer">å®¹å™¨é“¾æ¥<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€‚</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>node <span class="token punctuation">{</span>
    checkout scm
    docker<span class="token punctuation">.</span><span class="token function">image</span><span class="token punctuation">(</span><span class="token string">'mysql:5'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withRun</span><span class="token punctuation">(</span><span class="token string">'-e &quot;MYSQL_ROOT_PASSWORD=my-secret-pw&quot;'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> c <span class="token operator">-&gt;</span>
        docker<span class="token punctuation">.</span><span class="token function">image</span><span class="token punctuation">(</span><span class="token string">'mysql:5'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">inside</span><span class="token punctuation">(</span><span class="token string gstring">&quot;--link <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>c<span class="token punctuation">.</span>id<span class="token punctuation">}</span></span>:db&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">/* Wait until mysql service is up */</span>
            sh <span class="token string">'while ! mysqladmin ping -hdb --silent; do sleep 1; done'</span>
        <span class="token punctuation">}</span>
        docker<span class="token punctuation">.</span><span class="token function">image</span><span class="token punctuation">(</span><span class="token string">'centos:7'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">inside</span><span class="token punctuation">(</span><span class="token string gstring">&quot;--link <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>c<span class="token punctuation">.</span>id<span class="token punctuation">}</span></span>:db&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">/*
             * Run some tests which require MySQL, and assume that it is
             * available on the host name `db`
             */</span>
            sh <span class="token string">'make check'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>ä¸Šé¢çš„ç¤ºä¾‹ä½¿ç”¨ <code>withRun</code>å…¬å¼€çš„é¡¹ç›®, å®ƒé€šè¿‡ <code>id</code> å±æ€§å…·æœ‰å¯ç”¨çš„è¿è¡Œå®¹å™¨çš„IDã€‚ä½¿ç”¨è¯¥å®¹å™¨çš„ ID, æµæ°´çº¿é€šè¿‡è‡ªå®šä¹‰ Docker å‚æ•°ç”Ÿæˆä¸€ä¸ªåˆ°<code>inside()</code> æ–¹æ³•çš„é“¾ã€‚</p> <p>The <code>id</code> property can also be useful for inspecting logs from a running Docker container before the Pipeline exits:</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>sh <span class="token string gstring">&quot;docker logs <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>c<span class="token punctuation">.</span>id<span class="token punctuation">}</span></span>&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_12-withenv"><a href="#_12-withenv" class="header-anchor">#</a> 12ï¼ŒwithEnv</h3> <p>é»˜è®¤æƒ…å†µä¸‹å£°æ˜çš„ç¯å¢ƒå˜é‡çš„ç”Ÿæ•ˆæ—¶é—´éƒ½æ˜¯è´¯ç©¿æ•´ä¸ªæµæ°´çº¿å£°æ˜çš„ï¼Œå¦‚æœæƒ³è¦æ›´æ”¹ä¸€ä¸ªå˜é‡çš„å€¼ï¼Œåˆ™å¯ä»¥ç”¨ <code>withEnv</code>ä¸´æ—¶ä¿®æ”¹ï¼Œåœ¨åŒºå—ä¹‹å¤–å³æ¢å¤ï¼š</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>pipeline <span class="token punctuation">{</span>
   agent any
   environment <span class="token punctuation">{</span>
       Name <span class="token operator">=</span> <span class="token string">'null'</span>
   <span class="token punctuation">}</span>

   stages   <span class="token punctuation">{</span>
      <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'Stage 1'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        steps<span class="token punctuation">{</span>
            <span class="token function">catchError</span><span class="token punctuation">(</span>buildResult<span class="token punctuation">:</span> <span class="token string">'UNSTABLE'</span><span class="token punctuation">,</span> stageResult<span class="token punctuation">:</span> <span class="token string">'FAILURE'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
               script <span class="token punctuation">{</span>
                    echo env<span class="token punctuation">.</span>Test_Category_Name <span class="token comment">// è¾“å‡º null</span>
                    <span class="token function">withEnv</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string gstring">&quot;Name =Test&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                       echo env<span class="token punctuation">.</span>Test_Category_Name <span class="token comment">// è¾“å‡º Test</span>
                    <span class="token punctuation">}</span>
                    echo env<span class="token punctuation">.</span>Test_Category_Name <span class="token comment">// è¾“å‡º null</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>å‚è€ƒå†…å®¹ï¼š</p> <ul><li><a href="https://jenkins.io/zh/doc/book/pipeline/syntax/" target="_blank" rel="noopener noreferrer">Jenkinså®˜æ–¹æ–‡æ¡£<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>https://blog.csdn.net/u011541946</li> <li>Jenkins 2.xå®è·µæŒ‡å—</li></ul></div></div>  <div class="page-edit"><!----> <div class="tags"><a href="/tags/?tag=jenkins" title="æ ‡ç­¾">#jenkins</a><a href="/tags/?tag=%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3" title="æ ‡ç­¾">#é…ç½®è¯¦è§£</a></div> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">2022/01/15, 14:29:01</span></div></div> <div class="page-nav-wapper"><!----> <div class="page-nav"><p class="inner"><span class="prev">
        â†
        <a href="/pages/3292.html" class="prev">pipelineç¬”è®°ä¹‹ä»ä¸€ä¸ªç®€å•çš„é¡¹ç›®æ„å»ºå¼€å§‹</a></span> <span class="next"><a href="/pages/3304.html">è‡ªåŠ¨æ„å»ºçš„åŸå§‹é…ç½®ä»¥åŠpipelineä¸­çš„ç”¨æ³•</a>â†’
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">æœ€è¿‘æ›´æ–°</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/02cfc7/"><div>
            å­¦ä¹ å‘¨åˆŠ-2022å¹´ç¬¬10å‘¨
            <span class="title-tag">
              åŸåˆ›
            </span></div></a> <span class="date">03-19</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/383679/"><div>
            MongoDBè‡ªå¢IDåœ¨golangä¸­çš„å®è·µ
            <span class="title-tag">
              åŸåˆ›
            </span></div></a> <span class="date">03-18</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/4bbad9/"><div>
            MongoDBå…³è”æŸ¥è¯¢çš„å­¦ä¹ ä»¥åŠå®è·µ
            <span class="title-tag">
              åŸåˆ›
            </span></div></a> <span class="date">03-16</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">æ›´å¤šæ–‡ç« &gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="https://github.com/eryajf" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="mailto:Linuxlql@163.com" title="å‘é‚®ä»¶" target="_blank" class="iconfont icon-youjian"></a><a href="https://wiki.eryajf.net/rss.xml" title="è®¢é˜…" target="_blank" class="iconfont icon-rss"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="æœ¬ç«™ä¸»é¢˜">Vdoing</a> 
    | Copyright Â© 2017-2022
    <span>| <a href="https://www.foreverblog.cn/" class="d-inline-block text-muted" target="_blank" rel="external nofollow"><img src="https://t.eryajf.net/imgs/2022/01/964560013b68c2e4.png" alt="ç‚¹å‡»æŸ¥çœ‹åå¹´ä¹‹çº¦" style="width:auto;height:11px;"> | <a rel="nofollow " target="_blank" href="https://beian.miit.gov.cn/">æµ™ICPå¤‡18057030å·</a></span></div> <div class="buttons"><div title="è¿”å›é¡¶éƒ¨" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="å»è¯„è®º" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="ä¸»é¢˜æ¨¡å¼" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          è·Ÿéšç³»ç»Ÿ
        </li><li class="iconfont icon-rijianmoshi">
          æµ…è‰²æ¨¡å¼
        </li><li class="iconfont icon-yejianmoshi">
          æ·±è‰²æ¨¡å¼
        </li><li class="iconfont icon-yuedu">
          é˜…è¯»æ¨¡å¼
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><canvas id="vuepress-canvas-cursor"></canvas><!----><!----><div></div></div></div>
    <script src="/assets/js/app.b64d52e0.js" defer></script><script src="/assets/js/2.09106d93.js" defer></script><script src="/assets/js/254.dd193812.js" defer></script>
  </body>
</html>
